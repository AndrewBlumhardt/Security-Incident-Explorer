{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "version": "KqlParameterItem/1.0",
            "name": "DefaultSubscription_Internal",
            "type": 1,
            "isRequired": true,
            "query": "where type =~ 'microsoft.operationalinsights/workspaces'\r\n| take 1\r\n| project subscriptionId",
            "crossComponentResources": [
              "value::selected"
            ],
            "isHiddenWhenLocked": true,
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "id": "a25b8f4d-232c-4c9a-89da-7efdcfe54f18"
          },
          {
            "id": "eecbfca9-fb92-4efa-8e1e-e1daa62a28e9",
            "version": "KqlParameterItem/1.0",
            "name": "Subscription",
            "type": 6,
            "isRequired": true,
            "query": "summarize by subscriptionId\r\n| project value = strcat(\"/subscriptions/\", subscriptionId), label = subscriptionId, selected = iff(subscriptionId =~ '{DefaultSubscription_Internal}', true, false)",
            "typeSettings": {
              "showDefault": false
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources"
          },
          {
            "id": "92b215c1-c11e-4f92-9bb3-89bba2f008df",
            "version": "KqlParameterItem/1.0",
            "name": "Workspace",
            "type": 5,
            "isRequired": true,
            "query": "resources\r\n| where type =~ 'microsoft.operationalinsights/workspaces'\r\n| order by name asc\r\n| summarize Selected = makelist(id, 10), All = makelist(id, 1000)\r\n| mvexpand All limit 100\r\n| project value = tostring(All), label = tostring(All), selected = iff(Selected contains All, true, false)",
            "crossComponentResources": [
              "{Subscription}"
            ],
            "typeSettings": {
              "showDefault": false
            },
            "queryType": 1,
            "resourceType": "microsoft.resourcegraph/resources",
            "value": "/subscriptions/<subscription-id>/resourceGroups/<resource-group>/providers/Microsoft.OperationalInsights/workspaces/<workspace-name>"
          },
          {
            "id": "6d1219db-ff68-4fe9-b274-4cac028605da",
            "version": "KqlParameterItem/1.0",
            "name": "TimeRange",
            "type": 4,
            "description": "Set the timespan for the time brush view below",
            "isRequired": true,
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 43200000
                },
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 172800000
                },
                {
                  "durationMs": 259200000
                },
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 1209600000
                },
                {
                  "durationMs": 2592000000
                },
                {
                  "durationMs": 5184000000
                },
                {
                  "durationMs": 7776000000
                }
              ],
              "allowCustom": true
            },
            "value": {
              "durationMs": 259200000
            },
            "label": "‚è±Ô∏èTime Range"
          },
          {
            "id": "ced624f6-85ee-4c9e-ae31-4967d755da47",
            "version": "KqlParameterItem/1.0",
            "name": "HideClosed",
            "label": "Hide Closed",
            "type": 10,
            "isRequired": true,
            "query": "{\"version\":\"1.0.0\",\"content\":\"[{ \\\"value\\\": \\\"['Active', 'New']\\\", \\\"label\\\": \\\"Yes\\\"},\\r\\n {\\\"value\\\": \\\"['Active', 'New', 'Closed']\\\", \\\"label\\\": \\\"No\\\", \\\"selected\\\":true }]\",\"transformers\":null}",
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "queryType": 8,
            "value": "['Active', 'New']"
          },
          {
            "version": "KqlParameterItem/1.0",
            "name": "Help",
            "label": "Show Help",
            "type": 10,
            "isRequired": true,
            "query": "{\"version\":\"1.0.0\",\"content\":\"[{ \\\"value\\\": \\\"Yes\\\", \\\"label\\\": \\\"Yes\\\"},\\r\\n {\\\"value\\\": \\\"No\\\", \\\"label\\\": \\\"No\\\", \\\"selected\\\":true }]\",\"transformers\":null}",
            "typeSettings": {
              "additionalResourceOptions": [],
              "showDefault": false
            },
            "queryType": 8,
            "id": "f565bd0f-3c02-490c-8dba-cad6d8005cf8"
          }
        ],
        "style": "pills",
        "queryType": 8
      },
      "name": "Parameter Selectors - Copy",
      "styleSettings": {
        "margin": "20",
        "padding": "20"
      }
    },
    {
      "type": 1,
      "content": {
        "json": "<br>\r\nIntroduction\r\n\r\nUse this workbook to find all relevant information for related entities in one place. Based on Minimum Detection Actions (MDA) objectives including expansion of all linked entities, aler history, processes network connections, registry, PowerShell, CMD, account history, installed software, common persistence indicators, Virus Total results, and threat intelligence indicators.\r\n\r\nQuick Start:\r\n1. Find one or more incident (increase Time Range above if needed).\r\n2. Select or more entity for deeper investigation.\r\n3. Lookup specific entities on the other tabs.\r\n\r\nDetailed Instructions:\r\n\r\nIdentify one or more primary incident using the search or timeline. Note that incidents listed may have been closed or consolidated. If no entities are produced, make sure you have the current (parent) incident.\r\n\r\nYou can select multiple incidents or multiple entities to explore, though focusing on 1-2 will produce better results. Use the search bar to narrow down results.\r\n\r\nReminder: Incidents contain alerts and alerts usually contain entities (Accounts, Devices, IPs, URLs, etc.). Entities are required for this workbook to function.\r\n\r\nResults can be improved by customizing to exclude common actions by updating the KQL on the impacted tile upon request.\r\n\r\nOn the subsequent tabs [Under Development], you can research specific entitles like devices and IP addresses. Due to display limits, these require manual entry of the entity name or identifier.\r\n\r\nLimitations:\r\n* Some of the device and user details provided in the Defender XDR portal are difficult to reproduce using KQL queries. It is a good practice to review the user and device profiles in the XDR Portal when a closer review is needed.\r\n* Entra user details are not available in the logs and cannot be displayed here. For example, user details and role assignments. These insights can be found in the Entra and Defender XDR portals. You could create a logic app to archive the user profile data if needed.\r\n* Installed and running software is not generally available in the Sentinel logs. This information can be found in the Defender XDR Portal in various Threat & Vulnerability (TVM) views and tables.\r\n* The MDE (MDAV) sensor can be onboarded but inactive (passive). You cannot determine active vs. passive using Sentinel logs (only found in the XDR-TVM tables.\r\n* Some recorded entities lack sufficient information for deeper analysis. For example, improperly configured entity maps on custom rules. Also, basic file entities are created for all process entities.\r\n* Few IP related logs include location data making it hard to map. The KQL function to lookup locaiton called geo_info_from_ip_address() is not available in GCCH.\r\n* No current method for Virus Total reporting at this time.\r\n\r\nContact Andrew Blumhardt (andrew@blumardt.net) for bugs and feature requests.\r\n\r\n<br>."
      },
      "conditionalVisibility": {
        "parameterName": "Help",
        "comparison": "isEqualTo",
        "value": "Yes"
      },
      "name": "Header Text"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "tabStyle": "bigger",
        "links": [
          {
            "id": "feb31e54-3a99-4785-93a8-fd4f8eed69b3",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Incident Explorer",
            "subTarget": "Main",
            "style": "link"
          },
          {
            "id": "92e525fb-54f5-4553-a2d5-3c990fe398b5",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Account Explorer",
            "subTarget": "Accounts",
            "style": "link"
          },
          {
            "id": "0f2c4ea5-51f4-4a65-af5a-3b71e2dfac4a",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Device Explorer",
            "subTarget": "Devices",
            "style": "link"
          },
          {
            "id": "d93f1610-28a9-41ef-bc17-8711ca8503b9",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "IP Explorer",
            "subTarget": "IPs",
            "style": "link"
          }
        ]
      },
      "name": "links - 6"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "SecurityIncident\r\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\r\n| summarize count() by bin(TimeGenerated, 1h)\r\n",
              "size": 4,
              "showAnalytics": true,
              "timeContextFromParameter": "TimeRange",
              "timeBrushParameterName": "TimeBrush",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "visualization": "timechart"
            },
            "name": "Incident Timebrush"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let HideClosed = dynamic([{HideClosed}]);\r\nSecurityIncident\r\n//| where AlertIds != \"[]\"\r\n| summarize arg_max(TimeGenerated, *) by IncidentName\r\n//| sort by FirstActivityTime desc\r\n| extend AlertCount = AdditionalData.alertsCount\r\n| where Status in (HideClosed)\r\n| project Started=format_datetime(FirstActivityTime, \"M/d, h:mm tt\"), Updated=format_datetime(LastActivityTime, \"M/d, h:mm tt\"),SIEM_ID=toint(IncidentNumber), MDE_ID=toint(ProviderIncidentId), Title, Severity, Status, Source=ProviderName, Owner=Owner.assignedTo, Alerts=AlertCount, ['Incdident URL']=AdditionalData.providerIncidentUrl\r\n\r\n//Status (open-closed) is not displayed because the alert array is often missing from closed alerts. In this context, closed or open makes no difference.\r\n",
              "size": 1,
              "showAnalytics": true,
              "title": "Find & Select Incidents",
              "timeContextFromParameter": "TimeBrush",
              "exportMultipleValues": true,
              "exportedParameters": [
                {
                  "fieldName": "MDE_ID",
                  "parameterName": "MDE_ID",
                  "parameterType": 1
                },
                {
                  "fieldName": "AlertIds",
                  "parameterName": "AlertIds",
                  "parameterType": 1
                },
                {
                  "fieldName": "SIEM_ID",
                  "parameterName": "Sentinel_ID",
                  "parameterType": 1
                }
              ],
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "crossComponentResources": [
                "{Workspace}"
              ],
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "Started",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "Updated",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "SIEM_ID",
                    "formatter": 1,
                    "formatOptions": {
                      "customColumnWidthSetting": "12ch"
                    }
                  },
                  {
                    "columnMatch": "MDE_ID",
                    "formatter": 1,
                    "formatOptions": {
                      "customColumnWidthSetting": "12ch"
                    }
                  },
                  {
                    "columnMatch": "Title",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "60ch"
                    }
                  },
                  {
                    "columnMatch": "Severity",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "High",
                          "representation": "4",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "contains",
                          "thresholdValue": "Medium",
                          "representation": "3",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "contains",
                          "thresholdValue": "Low",
                          "representation": "2",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "contains",
                          "thresholdValue": "Informational",
                          "representation": "1",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "success",
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "14ch"
                    }
                  },
                  {
                    "columnMatch": "Status",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "contains",
                          "thresholdValue": "Closed",
                          "representation": "cancelled",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "contains",
                          "thresholdValue": "Active",
                          "representation": "pending",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "success",
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "14ch"
                    }
                  },
                  {
                    "columnMatch": "Source",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "16ch"
                    }
                  },
                  {
                    "columnMatch": "Owner",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "35ch"
                    }
                  },
                  {
                    "columnMatch": "Alerts",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "12ch"
                    }
                  },
                  {
                    "columnMatch": "Incdident URL",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "Url",
                      "linkLabel": "Open Incident in a New Window",
                      "customColumnWidthSetting": "40ch"
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              },
              "sortBy": []
            },
            "name": "Incident List"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let Sentinel_ID = dynamic([{Sentinel_ID}]);\r\nSecurityIncident\r\n| where IncidentNumber in (Sentinel_ID)\r\n| where AlertIds != \"[]\"\r\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\r\n| mvexpand todynamic(AlertIds)\r\n| extend SystemAlertId = tostring(AlertIds)\r\n| join SecurityAlert on SystemAlertId\r\n| extend Expand = parse_json(Entities)\r\n| mvexpand Expand\r\n| extend Type = tostring(Expand.Type)\r\n| summarize arg_max(TimeGenerated, *) by SystemAlertId\r\n| extend ProductName = tostring(parse_json(tostring(AdditionalData.alertProductNames))[0])\r\n| extend ProductName = case( \r\n    ProductName == \"Azure Sentinel\", \"Sentinel\",\r\n    ProductName == \"Azure Active Directory Identity Protection\", \"Entra IP\",\r\n    ProductName == \"Azure Advanced Threat Protection\", \"Defender XDR\",\r\n    ProductName == \"Microsoft Cloud App Security\", \"Cloud App Security\",\r\n    ProductName == \"Microsoft Data Loss Prevention\", \"Microsoft DLP\",\r\n    ProductName == \"Microsoft 365 Defender\", \"Defender for Office\",\r\n    ProductName == \"Office 365 Advanced Threat Protection\", \"Defender for Office\",\r\n    ProductName == \"Microsoft Defender Advanced Threat Protection\", \"Defender for Endpoint\", ProductName )\r\n| project TimeGenerated=format_datetime(FirstActivityTime, \"MM/dd/yyyy, hh:mm tt\"), ID=IncidentNumber, Incident=Title, Alert=AlertName, Severity, Tactics, Type, ProductName, ['Alert URL']=AlertLink\r\n\r\n//Unable to expand user entity from or phish \"Email reported by user as malware or phish\"\r\n",
              "size": 1,
              "showAnalytics": true,
              "title": "Linked Alerts",
              "timeContext": {
                "durationMs": 2592000000
              },
              "showRefreshButton": true,
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "TimeGenerated",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  },
                  {
                    "columnMatch": "ID",
                    "formatter": 1,
                    "formatOptions": {
                      "customColumnWidthSetting": "12ch"
                    }
                  },
                  {
                    "columnMatch": "Incident",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "24ch"
                    }
                  },
                  {
                    "columnMatch": "Alert",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "50ch"
                    }
                  },
                  {
                    "columnMatch": "Severity",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "14ch"
                    }
                  },
                  {
                    "columnMatch": "Tactics",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "14ch"
                    }
                  },
                  {
                    "columnMatch": "Type",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "10ch"
                    }
                  },
                  {
                    "columnMatch": "ProductName",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "22ch"
                    }
                  },
                  {
                    "columnMatch": "Alert URL",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "Url",
                      "linkLabel": "Open Alert in a New Window",
                      "customColumnWidthSetting": "30ch"
                    }
                  },
                  {
                    "columnMatch": "AlertID",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "38ch"
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "TimeGenerated",
                    "sortOrder": 1
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "TimeGenerated",
                  "sortOrder": 1
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "Sentinel_ID",
              "comparison": "isNotEqualTo"
            },
            "name": "Linked Alerts",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let Sentinel_ID = dynamic([{Sentinel_ID}]);\r\nlet EntitySearch = SecurityIncident\r\n| where AlertIds != \"[]\"\r\n| where IncidentNumber in (Sentinel_ID)\r\n| mvexpand todynamic(AlertIds)\r\n| summarize arg_max(TimeGenerated, *) by tostring(AlertIds)\r\n| extend SystemAlertId = tostring(AlertIds)\r\n| join SecurityAlert on SystemAlertId\r\n| summarize arg_max(TimeGenerated, *) by tostring(AlertIds)\r\n| extend Expand = parse_json(Entities)\r\n| mvexpand todynamic(Entities)\r\n| extend Type = Entities.Type\r\n| where isnotempty(Type)\r\n| extend Name = Entities.Name\r\n| extend Name = iff(Type == \"host\", Entities.HostName, Name)\r\n| extend Name = iff(Type == \"process\", Entities.CommandLine, Name)\r\n| extend Name = iff(Type == \"ip\", Entities.Address, Name)\r\n| extend Name = iff(Type == \"mailbox\", Entities.MailboxPrimaryAddress, Name)\r\n| extend Name = iff(Type == \"url\", Entities.Url, Name)\r\n| extend Name = iff(Type == \"filehash\", Entities.Value, Name)\r\n| extend Name = iff(Type == \"dns\", Entities.DomainName, Name)\r\n| where isnotempty(Name)\r\n| summarize make_list(Name);\r\nSecurityIncident\r\n| where AlertIds != \"[]\"\r\n| mvexpand todynamic(AlertIds)\r\n| extend SystemAlertId = tostring(AlertIds)\r\n| join SecurityAlert on SystemAlertId\r\n| extend Expand = parse_json(Entities)\r\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\r\n| mvexpand todynamic(Entities)\r\n| extend Type = Entities.Type\r\n| where isnotempty(Type)\r\n| extend Name = Entities.Name\r\n| extend Name = iff(Type == \"host\", Entities.HostName, Name)\r\n| extend Name = iff(Type == \"process\", Entities.CommandLine, Name)\r\n| extend Name = iff(Type == \"ip\", Entities.Address, Name)\r\n| extend Name = iff(Type == \"mailbox\", Entities.MailboxPrimaryAddress, Name)\r\n| extend Name = iff(Type == \"url\", Entities.Url, Name)\r\n| extend Name = iff(Type == \"filehash\", Entities.Value, Name)\r\n| extend Name = iff(Type == \"dns\", Entities.DomainName, Name)\r\n| where Name in (EntitySearch)\r\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\r\n| project TimeGenerated=format_datetime(FirstActivityTime, \"MM/dd/yyyy, hh:mm tt\"), SIEM_ID=IncidentNumber, Incident=Title, Type, ['üß© Common Entity']=Name, Severity, Status, Tactics, ['Incdident URL']=AdditionalData.providerIncidentUrl\r\n| sort by TimeGenerated desc ",
              "size": 1,
              "showAnalytics": true,
              "title": "Potential Related Incidents (by Common Entities)",
              "noDataMessage": "Selected incident(s) have no linked user entities.",
              "timeContext": {
                "durationMs": 2592000000
              },
              "exportedParameters": [
                {
                  "fieldName": "UPN",
                  "parameterName": "Users",
                  "parameterType": 1
                },
                {
                  "fieldName": "SID",
                  "parameterName": "SID",
                  "parameterType": 1
                }
              ],
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "TimeGenerated",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  },
                  {
                    "columnMatch": "SIEM_ID",
                    "formatter": 1,
                    "formatOptions": {
                      "customColumnWidthSetting": "12ch"
                    }
                  },
                  {
                    "columnMatch": "Incident",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "50ch"
                    }
                  },
                  {
                    "columnMatch": "Type",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "14ch"
                    }
                  },
                  {
                    "columnMatch": "üß© Common Entity",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "30ch"
                    }
                  },
                  {
                    "columnMatch": "Severity",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "14ch"
                    }
                  },
                  {
                    "columnMatch": "Status",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "14ch"
                    }
                  },
                  {
                    "columnMatch": "Tactics",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "18ch"
                    }
                  },
                  {
                    "columnMatch": "Incdident URL",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "Url",
                      "linkLabel": "Open Incident in a New Window"
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "üß© Common Entity",
                    "sortOrder": 2
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "üß© Common Entity",
                  "sortOrder": 2
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "Sentinel_ID",
              "comparison": "isNotEqualTo"
            },
            "name": "Potential Related Incidents (by Common Entities)",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let Sentinel_ID = dynamic([{Sentinel_ID}]);\r\nlet SID_Alerts = AlertEvidence\r\n| where isnotempty(AccountSid)\r\n| summarize arg_max(TimeGenerated, *) by AlertId;\r\nSecurityIncident\r\n| where AlertIds != \"[]\"\r\n| where IncidentNumber in (Sentinel_ID)\r\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\r\n| mvexpand todynamic(AlertIds)\r\n| extend SystemAlertId = tostring(AlertIds)\r\n| join SecurityAlert on SystemAlertId\r\n| extend Expand = parse_json(Entities)\r\n| mvexpand Expand\r\n| extend Type = tostring(Expand.Type)\r\n| where Type == \"account\" //or Type == \"mailbox\"\r\n| extend AadUserId = Expand.AadUserId\r\n| extend AccountName = tostring(Expand.AccountName)\r\n//| extend CreatedTimeUtc = Expand.CreatedTimeUtc\r\n| extend IsDomainJoined = Expand.IsDomainJoined\r\n| extend LastVerdict = Expand.LastVerdict\r\n| extend Type = Expand.Type\r\n| extend LastVerdict = Expand.LastVerdict\r\n| extend UserPrincipalName = Expand.UserPrincipalName\r\n| extend Name = tostring(Expand.Name)\r\n| extend AccountSid = tostring(Expand.Sid)\r\n| extend NTDomain = Expand.NTDomain\r\n| extend DnsDomain = Expand.DnsDomain\r\n| extend UPNSuffix = Expand.UPNSuffix\r\n| summarize arg_max(TimeGenerated, *) by Name, AccountName, AccountSid\r\n| where isnotempty(Name) and isnotempty(AccountName) //Removing accounts with insufficient entitiy data\r\n| extend Source = case(AccountSid startswith \"S-1-5-21\", \"Active Directory\", isempty(UserPrincipalName), \"Local Account\", isempty(AccountSid), \"Unknown\", \"Entra Tennant\")\r\n| extend XDR_URL = strcat(\"https://security.microsoft.us/user?sid=\", tolower(AccountSid))\r\n| join kind=leftouter SID_Alerts on AccountSid\r\n| summarize arg_max(TimeGenerated, *) by AccountName, AccountSid\r\n| project ['üë§ Display Name']=Name, AccountName, UserPrincipalName, UPNSuffix, Source, LastVerdict, AccountSid, DnsDomain, AccountDomain, AccountObjectId, ['User Profile']=XDR_URL\r\n",
              "size": 1,
              "showAnalytics": true,
              "title": "Select Account(s) to Expand",
              "noDataMessage": "Selected incident(s) have no linked account entities.",
              "timeContext": {
                "durationMs": 2592000000
              },
              "exportMultipleValues": true,
              "exportedParameters": [
                {
                  "fieldName": "UserPrincipalName",
                  "parameterName": "Users",
                  "parameterType": 1
                },
                {
                  "fieldName": "AccountSid",
                  "parameterName": "SID",
                  "parameterType": 1
                }
              ],
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "UPNSuffix",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "18ch"
                    }
                  },
                  {
                    "columnMatch": "AccountSid",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "25ch"
                    }
                  },
                  {
                    "columnMatch": "User Profile",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "Url",
                      "linkLabel": "User Profile in New Window"
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "AccountSid",
                    "sortOrder": 1
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "AccountSid",
                  "sortOrder": 1
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "Sentinel_ID",
              "comparison": "isNotEqualTo"
            },
            "name": "Select Account(s) to Expand",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let Users = dynamic([{Users}]);\r\nIdentityInfo\r\n| where AccountUPN in (Users)\r\n| where isnotempty(AccountUPN)\r\n| summarize arg_max(TimeGenerated, *) by AccountUPN\r\n| extend Location = strcat(City, \", \", State, \", \",Country)\r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), IsEnabled=IsAccountEnabled, AccountDisplayName, AccountUPN, AccountDomain, AccountCreationTime, Location, Department, JobTitle, MailAddress, CompanyName, GroupMembership, AssignedRoles,FQDN=OnPremisesDistinguishedName",
                    "size": 1,
                    "showAnalytics": true,
                    "title": "AD User Profile (MDI)",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "TimeGenerated",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "20ch"
                          }
                        },
                        {
                          "columnMatch": "IsEnabled",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "14ch"
                          }
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true
                    },
                    "sortBy": []
                  },
                  "conditionalVisibility": {
                    "parameterName": "Users",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "AD User Profile (MDI)",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let SID = dynamic([{SID}]);\r\nDeviceInfo\r\n| where TimeGenerated > ago(30d)\r\n| where LoggedOnUsers != \"[]\"\r\n| mvexpand todynamic(LoggedOnUsers)\r\n| extend SIDx = tostring(LoggedOnUsers.Sid)\r\n| where SIDx in (SID)\r\n| summarize arg_max(TimeGenerated, *) by DeviceId\r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), DeviceName, ExposureLevel, PublicIP, OSPlatform, ClientVersion, IsAzureADJoined, MachineGroup, DeviceId",
                    "size": 1,
                    "showAnalytics": true,
                    "title": "Recent MDE Workstation Logon (30 Days)",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "TimeGenerated",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "20ch"
                          }
                        },
                        {
                          "columnMatch": "DeviceName",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "22ch"
                          }
                        },
                        {
                          "columnMatch": "ExposureLevel",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "High",
                                "representation": "4",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Medium",
                                "representation": "3",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "Low",
                                "representation": "2",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        },
                        {
                          "columnMatch": "PublicIP",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "20ch"
                          }
                        },
                        {
                          "columnMatch": "OSPlatform",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "16ch"
                          }
                        },
                        {
                          "columnMatch": "ClientVersion",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "20ch"
                          }
                        },
                        {
                          "columnMatch": "IsAzureADJoined",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "16ch"
                          }
                        },
                        {
                          "columnMatch": "MachineGroup",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "30ch"
                          }
                        },
                        {
                          "columnMatch": "DeviceId",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "45ch"
                          }
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true
                    },
                    "sortBy": []
                  },
                  "conditionalVisibility": {
                    "parameterName": "Users",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "Recent MDE Workstation Logon (30 Days)",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let Users = dynamic([{Users}]);\r\nBehaviorAnalytics\r\n| where UserPrincipalName in (Users)\r\n| summarize arg_max(TimeGenerated, *) by UserPrincipalName, tostring(ActivityInsights.App)\r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), Priority=toint(InvestigationPriority), ActivityType, ActionType, UnusualAction = ActivityInsights.ActionUncommonlyPerformedByUser, UnusualDevice = ActivityInsights.DeviceUncommonlyUsedInTenant, FirstConnection = ActivityInsights.FirstTimeUserConnectedFromDevice, HighVolume = ActivityInsights.UncommonHighVolumeOfActions, UserPrincipalName, App = ActivityInsights.App, SourceDevice, SourceIPAddress, SourceIPLocation\r\n| sort by TimeGenerated desc",
                    "size": 1,
                    "showAnalytics": true,
                    "title": "Sentinel UEBA Activity - Sentinel (30 Days)",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "TimeGenerated",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "20ch"
                          }
                        },
                        {
                          "columnMatch": "Priority",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 0,
                            "max": 5,
                            "palette": "red",
                            "customColumnWidthSetting": "12ch"
                          }
                        },
                        {
                          "columnMatch": "ActivityType",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "30ch"
                          }
                        },
                        {
                          "columnMatch": "ActionType",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "30ch"
                          }
                        },
                        {
                          "columnMatch": "UnusualAction",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "representation": "gray",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "True",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "text": "{0}{1}"
                              }
                            ],
                            "customColumnWidthSetting": "16ch"
                          }
                        },
                        {
                          "columnMatch": "UnusualDevice",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "True",
                                "representation": "gray",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "text": "{0}{1}"
                              }
                            ],
                            "customColumnWidthSetting": "16ch"
                          }
                        },
                        {
                          "columnMatch": "FirstConnection",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "True",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "text": "{0}{1}"
                              }
                            ],
                            "customColumnWidthSetting": "16ch"
                          }
                        },
                        {
                          "columnMatch": "HighVolume",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "True",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "text": "{0}{1}"
                              }
                            ],
                            "customColumnWidthSetting": "16ch"
                          }
                        },
                        {
                          "columnMatch": "App",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "25ch"
                          }
                        },
                        {
                          "columnMatch": "SourceDevice",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "29ch"
                          }
                        },
                        {
                          "columnMatch": "SourceIPAddress",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "21ch"
                          }
                        },
                        {
                          "columnMatch": "SourceIPLocation",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "31ch"
                          }
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true
                    },
                    "sortBy": []
                  },
                  "conditionalVisibility": {
                    "parameterName": "Users",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "Sentinel UEBA Activity - Sentinel (30 Days)",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let Users = dynamic([{Users}]);\r\nAnomalies \r\n| where UserPrincipalName in (Users)\r\n| extend  UserCreated = ActivityInsights.UserCreated\r\n| extend  AccountDisplayName = UserInsights.AccountDisplayName\r\n| extend IsNewAccount = UserInsights.IsNewAccount\r\n| extend AnomalyReason = tostring(AnomalyReasons[0].Name)\r\n| project TimeGenerated, AccountDisplayName, UserName, UserPrincipalName, IsNewAccount, UserCreated, AnomalyReason, RuleName, Description\r\n| sort by TimeGenerated desc",
                    "size": 1,
                    "showAnalytics": true,
                    "title": "Sentinel Anomalies Activity - Sentinel (30 Days)",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "TimeGenerated",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "20ch"
                          }
                        },
                        {
                          "columnMatch": "Priority",
                          "formatter": 8,
                          "formatOptions": {
                            "min": 0,
                            "max": 5,
                            "palette": "red",
                            "customColumnWidthSetting": "12ch"
                          }
                        },
                        {
                          "columnMatch": "ActivityType",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "30ch"
                          }
                        },
                        {
                          "columnMatch": "ActionType",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "30ch"
                          }
                        },
                        {
                          "columnMatch": "UnusualAction",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "representation": "gray",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "==",
                                "thresholdValue": "True",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "text": "{0}{1}"
                              }
                            ],
                            "customColumnWidthSetting": "16ch"
                          }
                        },
                        {
                          "columnMatch": "UnusualDevice",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "True",
                                "representation": "gray",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "text": "{0}{1}"
                              }
                            ],
                            "customColumnWidthSetting": "16ch"
                          }
                        },
                        {
                          "columnMatch": "FirstConnection",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "True",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "text": "{0}{1}"
                              }
                            ],
                            "customColumnWidthSetting": "16ch"
                          }
                        },
                        {
                          "columnMatch": "HighVolume",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "True",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "text": "{0}{1}"
                              }
                            ],
                            "customColumnWidthSetting": "16ch"
                          }
                        },
                        {
                          "columnMatch": "App",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "25ch"
                          }
                        },
                        {
                          "columnMatch": "SourceDevice",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "29ch"
                          }
                        },
                        {
                          "columnMatch": "SourceIPAddress",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "21ch"
                          }
                        },
                        {
                          "columnMatch": "SourceIPLocation",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "31ch"
                          }
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true
                    },
                    "sortBy": []
                  },
                  "conditionalVisibility": {
                    "parameterName": "Users",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "Sentinel Anomalies Activity - Sentinel (30 Days)",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let Users = dynamic([{Users}]);\r\nCloudAppEvents\r\n| extend UPN = tostring(RawEventData.UserId)\r\n| where UPN in (Users)\r\n| where ActivityType != \"Sync\" and ActivityType != \"Basic\"\r\n| extend  IsSatelliteProvider = AdditionalFields.IsSatelliteProvider\r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"),  Action=ActionType, Activity=ActivityType, ObjectType, ObjectName,Application, AccountType, User=UPN, UserAgent, IsAnonymousProxy, IsImpersonated, IsExternalUser, IsAdminOperation, IsSatelliteProvider, OSPlatform, ISP, IPAddress, IPCategory\r\n| sort by TimeGenerated desc",
                    "size": 1,
                    "showAnalytics": true,
                    "title": "Cloud Apps Activity - MDCA (30 Days)",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "TimeGenerated",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "20ch"
                          }
                        },
                        {
                          "columnMatch": "Action",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "25ch"
                          }
                        },
                        {
                          "columnMatch": "Activity",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "25ch"
                          }
                        },
                        {
                          "columnMatch": "ObjectType",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "20ch"
                          }
                        },
                        {
                          "columnMatch": "ObjectName",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "30ch"
                          }
                        },
                        {
                          "columnMatch": "AccountType",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "==",
                                "thresholdValue": "Admin",
                                "representation": "red",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "text": "{0}{1}"
                              }
                            ],
                            "customColumnWidthSetting": "17ch"
                          }
                        },
                        {
                          "columnMatch": "IsSatelliteProvider",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "22ch"
                          }
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true
                    },
                    "sortBy": []
                  },
                  "conditionalVisibility": {
                    "parameterName": "Users",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "Cloud Apps Activity - MDCA (30 Days)",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let Users = dynamic([{Users}]);\r\nOfficeActivity\r\n| where UserId in (Users)\r\n| where Operation !contains \"Sync\"\r\n|project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), UserId, UserType, Logon_Type, ExternalAccess, OfficeWorkload, Operation, ItemType, Subject=parse_json(AffectedItems)[0].Subject, Site_Url, RecordType, SourceFileName, ResultStatus, ClientIP, IsManagedDevice\r\n| sort by TimeGenerated desc",
                    "size": 1,
                    "showAnalytics": true,
                    "title": "Office Activity - MDO (30 Days)",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "TimeGenerated",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "20ch"
                          }
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true
                    },
                    "sortBy": []
                  },
                  "conditionalVisibility": {
                    "parameterName": "Users",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "Office Activity - MDO (30 Days)",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let Users = dynamic([{Users}]);\r\nEmailEvents\r\n| where RecipientEmailAddress in (Users) or SenderDisplayName in (Users)\r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), RecipientEmailAddress, SenderDisplayName, SenderFromAddress, SenderIPv4, Subject, AttachmentCount, UrlCount\r\n| sort by TimeGenerated desc",
                    "size": 1,
                    "showAnalytics": true,
                    "title": "Emails Sent & Received - MDO (30 Days)",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "TimeGenerated",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "20ch"
                          }
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true
                    },
                    "sortBy": []
                  },
                  "conditionalVisibility": {
                    "parameterName": "Users",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "Emails Sent & Received - MDO (30 Days)",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let Users = dynamic([{Users}]);\r\nEmailAttachmentInfo\r\n| where RecipientEmailAddress in (Users) or SenderDisplayName in (Users)\r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), RecipientEmailAddress, SenderDisplayName, SenderFromAddress, FileName, FileSize\r\n| sort by TimeGenerated desc",
                    "size": 1,
                    "showAnalytics": true,
                    "title": "Attachments Sent & Received - MDO (30 Days)",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "TimeGenerated",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "20ch"
                          }
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true
                    },
                    "sortBy": []
                  },
                  "conditionalVisibility": {
                    "parameterName": "Users",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "Attachments Sent & Received - MDO (30 Days)",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let Users = dynamic([{Users}]);\r\nUrlClickEvents\r\n| where AccountUpn in (Users)\r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), AccountUpn, Workload, ActionType, Url, IPAddress, UrlChain, IsClickedThrough\r\n| sort by TimeGenerated desc",
                    "size": 1,
                    "showAnalytics": true,
                    "title": "URLs Clicked - MDO (30 Days)",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "TimeGenerated",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "20ch"
                          }
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true
                    },
                    "sortBy": []
                  },
                  "conditionalVisibility": {
                    "parameterName": "Users",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "URLs Clicked - MDO (30 Days)",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let Users = dynamic([{Users}]);\r\nunion isfuzzy=true (IdentityDirectoryEvents), (IdentityLogonEvents),(IdentityQueryEvents)\r\n| where AccountUpn in (Users)\r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), ActionType, LogonType, FailureReason, Application, Protocol, AccountUpn, DeviceName, IPAddress, Type, QueryTarget",
                    "size": 1,
                    "showAnalytics": true,
                    "title": "MDI Activity - Local Domain (30 Days)",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "TimeGenerated",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "20ch"
                          }
                        },
                        {
                          "columnMatch": "Application",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "24ch"
                          }
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true
                    },
                    "sortBy": []
                  },
                  "conditionalVisibility": {
                    "parameterName": "Users",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "MDI Activity - Local Domain  (30 Days)",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let Users = dynamic([{Users}]);\r\nSigninLogs\r\n| where UserPrincipalName in (Users)\r\n| extend authenticationMethod = parse_json(AuthenticationDetails)[0].authenticationMethod\r\n| extend Browser = DeviceDetail.browser\r\n| extend DeviceId = DeviceDetail.deviceId\r\n| extend OS = DeviceDetail.operatingSystem\r\n| extend City = LocationDetails.city\r\n| extend State = LocationDetails.state\r\n| extend Country = LocationDetails.countryOrRegion\r\n| extend Latitude = parse_json(tostring(LocationDetails.geoCoordinates)).latitude\r\n| extend Longitude = parse_json(tostring(LocationDetails.geoCoordinates)).longitude\r\n| extend Network = parse_json(NetworkLocationDetails)[0].networkType\r\n| extend NamedNet = parse_json(tostring(parse_json(NetworkLocationDetails)[0].networkNames))[0]\r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), UserDisplayName, UserPrincipalName, UserType, RiskDetail, RiskState, AuthenticationRequirement, ConditionalAccessStatus, MfaDetail, ResultDescription, AppDisplayName, ResourceDisplayName, ClientAppUsed, Browser, DeviceId, OS, IPAddress, Network, NamedNet, City, State, Country, Latitude, Longitude\r\n| sort by TimeGenerated desc",
                    "size": 1,
                    "showAnalytics": true,
                    "title": "Entra SignIn Activity (30 Days)",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "TimeGenerated",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "20ch"
                          }
                        },
                        {
                          "columnMatch": "UserDisplayName",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "19.1429ch"
                          }
                        },
                        {
                          "columnMatch": "UserPrincipalName",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "22.1429ch"
                          }
                        },
                        {
                          "columnMatch": "UserType",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "10.4275ch"
                          }
                        },
                        {
                          "columnMatch": "RiskDetail",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "9.428ch"
                          }
                        },
                        {
                          "columnMatch": "RiskState",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "9.2854ch"
                          }
                        },
                        {
                          "columnMatch": "AuthenticationRequirement",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "17.1423ch"
                          }
                        },
                        {
                          "columnMatch": "ConditionalAccessStatus",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "9.7131ch"
                          }
                        },
                        {
                          "columnMatch": "MfaDetail",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "11.4286ch"
                          }
                        },
                        {
                          "columnMatch": "ResultDescription",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "19.4286ch"
                          }
                        },
                        {
                          "columnMatch": "AppDisplayName",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "26.8571ch"
                          }
                        },
                        {
                          "columnMatch": "ResourceDisplayName",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "27ch"
                          }
                        },
                        {
                          "columnMatch": "ClientAppUsed",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "19.1423ch"
                          }
                        },
                        {
                          "columnMatch": "Browser",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "19.4286ch"
                          }
                        },
                        {
                          "columnMatch": "DeviceId",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "22.2851ch"
                          }
                        },
                        {
                          "columnMatch": "OS",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "16.142ch"
                          }
                        },
                        {
                          "columnMatch": "IPAddress",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "15.1429ch"
                          }
                        },
                        {
                          "columnMatch": "Network",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "16.9997ch"
                          }
                        },
                        {
                          "columnMatch": "NamedNet",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "16ch"
                          }
                        },
                        {
                          "columnMatch": "City",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "14.1423ch"
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "9.2854ch"
                          }
                        },
                        {
                          "columnMatch": "Country",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "9.4278ch"
                          }
                        },
                        {
                          "columnMatch": "Latitude",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "8.1426ch"
                          }
                        },
                        {
                          "columnMatch": "Longitude",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "8.7137ch"
                          }
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "TimeGenerated",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "TimeGenerated",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "Users",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "Entra SignIn Activity (30 Days)",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let Users = dynamic([{Users}]);\r\nSigninLogs\r\n| where UserPrincipalName in (Users)\r\n| extend City = LocationDetails.city\r\n| extend State = LocationDetails.state\r\n| extend Country = LocationDetails.countryOrRegion\r\n| extend Latitude = parse_json(tostring(LocationDetails.geoCoordinates)).latitude\r\n| extend Longitude = parse_json(tostring(LocationDetails.geoCoordinates)).longitude\r\n| project TimeGenerated, City, State, Country, Latitude, Longitude\r\n| summarize count() by tostring(Latitude), tostring(Longitude), tostring(City)",
                    "size": 2,
                    "title": "SignIn Locations (Entra)",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "showRefreshButton": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "map",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "TimeGenerated",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "15.2846ch"
                          }
                        },
                        {
                          "columnMatch": "UserDisplayName",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "19.1429ch"
                          }
                        },
                        {
                          "columnMatch": "UserPrincipalName",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "22.1429ch"
                          }
                        },
                        {
                          "columnMatch": "UserType",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "10.4275ch"
                          }
                        },
                        {
                          "columnMatch": "RiskDetail",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "9.428ch"
                          }
                        },
                        {
                          "columnMatch": "RiskState",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "9.2854ch"
                          }
                        },
                        {
                          "columnMatch": "AuthenticationRequirement",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "17.1423ch"
                          }
                        },
                        {
                          "columnMatch": "ConditionalAccessStatus",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "9.7131ch"
                          }
                        },
                        {
                          "columnMatch": "MfaDetail",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "11.4286ch"
                          }
                        },
                        {
                          "columnMatch": "ResultDescription",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "19.4286ch"
                          }
                        },
                        {
                          "columnMatch": "AppDisplayName",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "26.8571ch"
                          }
                        },
                        {
                          "columnMatch": "ResourceDisplayName",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "27ch"
                          }
                        },
                        {
                          "columnMatch": "ClientAppUsed",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "19.1423ch"
                          }
                        },
                        {
                          "columnMatch": "Browser",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "19.4286ch"
                          }
                        },
                        {
                          "columnMatch": "DeviceId",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "22.2851ch"
                          }
                        },
                        {
                          "columnMatch": "OS",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "16.142ch"
                          }
                        },
                        {
                          "columnMatch": "IPAddress",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "15.1429ch"
                          }
                        },
                        {
                          "columnMatch": "Network",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "16.9997ch"
                          }
                        },
                        {
                          "columnMatch": "NamedNet",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "16ch"
                          }
                        },
                        {
                          "columnMatch": "City",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "14.1423ch"
                          }
                        },
                        {
                          "columnMatch": "State",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "9.2854ch"
                          }
                        },
                        {
                          "columnMatch": "Country",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "9.4278ch"
                          }
                        },
                        {
                          "columnMatch": "Latitude",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "8.1426ch"
                          }
                        },
                        {
                          "columnMatch": "Longitude",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "8.7137ch"
                          }
                        }
                      ],
                      "rowLimit": 10000,
                      "sortBy": [
                        {
                          "itemKey": "Longitude",
                          "sortOrder": 1
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "Longitude",
                        "sortOrder": 1
                      }
                    ],
                    "mapSettings": {
                      "locInfo": "LatLong",
                      "latitude": "Latitude",
                      "longitude": "Longitude",
                      "sizeSettings": "City",
                      "sizeAggregation": "Count",
                      "labelSettings": "City",
                      "legendMetric": "count_",
                      "numberOfMetrics": 1000,
                      "legendAggregation": "Sum",
                      "itemColorSettings": {
                        "nodeColorField": "count_",
                        "colorAggregation": "Sum",
                        "type": "heatmap",
                        "heatmapPalette": "greenRed"
                      }
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "Users",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "SignIn Locations (Entra)"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let Users = dynamic([{Users}]);\r\nAzureActivity\r\n| where isnotempty(Caller)\r\n| extend Caller2 = tolower(Caller)\r\n| where Caller in (Users) or Caller2 in (Users)\r\n| extend Status = parse_json(Properties).activityStatusValue\r\n| extend RBAC_Role = parse_json(tostring(parse_json(Authorization).evidence)).role\r\n| extend Target = parse_json(Properties).resource\r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), Caller, Level, Target, ResourceGroup, SubscriptionId, OperationNameValue, Status, RBAC_Role, CallerIpAddress, ResourceId, CategoryValue\r\n| sort by TimeGenerated desc",
                    "size": 1,
                    "showAnalytics": true,
                    "title": "Azure Admin Activity (30 Days)",
                    "noDataMessage": "The query returned no results. No Azure admin activity detected for selected accounts. ",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "TimeGenerated",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "16.9989ch"
                          }
                        },
                        {
                          "columnMatch": "Level",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "13.2846ch"
                          }
                        },
                        {
                          "columnMatch": "Target",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "29.142ch"
                          }
                        },
                        {
                          "columnMatch": "ResourceGroup",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "24.2857ch"
                          }
                        },
                        {
                          "columnMatch": "SubscriptionId",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "15.9994ch"
                          }
                        },
                        {
                          "columnMatch": "OperationNameValue",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "31.2857ch"
                          }
                        },
                        {
                          "columnMatch": "Status",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "17ch"
                          }
                        },
                        {
                          "columnMatch": "Caller",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "12ch"
                          }
                        },
                        {
                          "columnMatch": "RBAC_Role",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "15ch"
                          }
                        },
                        {
                          "columnMatch": "CallerIpAddress",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "21ch"
                          }
                        },
                        {
                          "columnMatch": "ResourceId",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "16ch"
                          }
                        },
                        {
                          "columnMatch": "CategoryValue",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "20ch"
                          }
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true
                    },
                    "sortBy": []
                  },
                  "conditionalVisibility": {
                    "parameterName": "Users",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "Azure Admin Activity (30 Days)",
                  "styleSettings": {
                    "showBorder": true
                  }
                }
              ]
            },
            "name": "Accounts"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let Sentinel_ID = dynamic([{Sentinel_ID}]);\r\nSecurityIncident\r\n| where AlertIds != \"[]\"\r\n| where IncidentNumber in (Sentinel_ID)\r\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\r\n| mvexpand todynamic(AlertIds)\r\n| extend SystemAlertId = tostring(AlertIds)\r\n| join SecurityAlert on SystemAlertId\r\n| project Expand = parse_json(Entities)\r\n| mvexpand Expand\r\n| extend Type = tostring(Expand.Type)\r\n| where Type == \"host\"\r\n| extend Type = tostring(Expand.Type)\r\n| extend AadDeviceId = tostring(Expand.AadDeviceId)\r\n| extend AvStatus = tostring(Expand.AvStatus)\r\n| extend DnsDomain = tostring(Expand.DnsDomain)\r\n| extend FQDN = tostring(Expand.FQDN)\r\n| extend HealthStatus = tostring(Expand.HealthStatus)\r\n| extend LastIpAddress = tostring(Expand.LastIpAddress)\r\n| extend ExternalIpAddress = tostring(Expand.LastExternalIpAddress)\r\n| extend LoggedOnUsers = tostring(Expand.LoggedOnUsers)\r\n| extend HostName = tostring(Expand.HostName)\r\n| extend LastSeen = tostring(Expand.LastSeen)\r\n| extend DeviceId = tostring(Expand.MdatpDeviceId)\r\n| extend OSFamily = tostring(Expand.OSFamily)\r\n| extend OnboardingStatus = tostring(Expand.OnboardingStatus)\r\n| extend RiskScore = tostring(Expand.RiskScore)\r\n| summarize arg_max(LastSeen, *) by DeviceId\r\n| join DeviceInfo on DeviceId\r\n| summarize arg_max(LastSeen, *) by DeviceId\r\n| extend URL = strcat(\"https://security.microsoft.us/machines/\", DeviceId)\r\n| extend RecentUsers = iif(LoggedOnUsers1 == \"[]\", LoggedOnUsers, LoggedOnUsers1)\r\n| project LastSeen_UTC=format_datetime(todatetime(LastSeen), \"M/d, h:mm tt\"), ['üíª HostName']=HostName, OSPlatform, RiskScore=toupper(RiskScore), ExposureLevel=toupper(ExposureLevel), LastIpAddress, ExternalIpAddress, FQDN, RecentUsers, IsMDE=OnboardingStatus, HealthStatus, AvStatus, IsExcluded=toupper(IsExcluded), JoinType, IsAzureADJoined, MachineGroup, DeviceDynamicTags, DeviceManualTags, RegistryDeviceTag, DeviceId, URL\r\n| sort by LastSeen_UTC desc",
              "size": 1,
              "showAnalytics": true,
              "title": "Select Device(s) to Expand (Based on MDE data)",
              "noDataMessage": "Selected incident(s) have no linked device entities.",
              "timeContext": {
                "durationMs": 2592000000
              },
              "showRefreshButton": true,
              "exportMultipleValues": true,
              "exportedParameters": [
                {
                  "fieldName": "DeviceId",
                  "parameterName": "DeviceIDs",
                  "parameterType": 1
                }
              ],
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "LastSeen_UTC",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  },
                  {
                    "columnMatch": "RiskScore",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "HIGH",
                          "representation": "4",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "MEDIUM",
                          "representation": "3",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "LOW",
                          "representation": "2",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "contains",
                          "thresholdValue": "INFO",
                          "representation": "1",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "success",
                          "text": "{0}{1}"
                        }
                      ]
                    },
                    "tooltipFormat": {
                      "tooltip": "General risk assessment"
                    }
                  },
                  {
                    "columnMatch": "ExposureLevel",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "HIGH",
                          "representation": "Sev0",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "MEDIUM",
                          "representation": "Sev1",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "Sev2",
                          "text": "{0}{1}"
                        }
                      ]
                    },
                    "tooltipFormat": {
                      "tooltip": "Based on XDR recommendations"
                    }
                  },
                  {
                    "columnMatch": "FQDN",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "40ch"
                    }
                  },
                  {
                    "columnMatch": "RecentUsers",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "40ch"
                    }
                  },
                  {
                    "columnMatch": "AvStatus",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Disabled",
                          "representation": "red",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "IsExcluded",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "True",
                          "representation": "red",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "URL",
                    "formatter": 7,
                    "formatOptions": {
                      "linkTarget": "Url",
                      "linkLabel": "Open Device in New Window"
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              },
              "sortBy": []
            },
            "conditionalVisibility": {
              "parameterName": "Sentinel_ID",
              "comparison": "isNotEqualTo"
            },
            "name": "Select Device(s) to Expand (Based on MDE data)",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let DeviceIDs = dynamic([{DeviceIDs}]);\r\nDeviceEvents\r\n| where DeviceId in (DeviceIDs)\r\n| where ActionType startswith \"Antivirus\" or ActionType == \"OtherAlertRelatedActivity\"\r\n| extend ScanType = AdditionalFields.ScanTypeIndex \r\n| extend TamperingAction = AdditionalFields.TamperingAction\r\n| extend ErrorCode = AdditionalFields.ErrorCode\r\n| extend ErrorDescription = AdditionalFields.ErrorDescription\r\n| extend IsPassiveMode = AdditionalFields.IsPassiveMode\r\n| extend ThreatName = AdditionalFields.ThreatName\r\n| extend WasExecutingWhileDetected = AdditionalFields.WasExecutingWhileDetected\r\n| extend WasRemediated = AdditionalFields.WasRemediated\r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), DeviceName, ActionType, ScanType, ThreatName, WasRemediated, FileName, FolderPath, SHA1, IsPassiveMode, WasExecutingWhileDetected, ErrorCode, ErrorDescription, AdditionalFields\r\n| sort by TimeGenerated desc \r\n| sort by ActionType asc\r\n\r\n",
                    "size": 1,
                    "showAnalytics": true,
                    "title": "AV Activity by Device (30 Days)",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "TimeGenerated",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "20ch"
                          }
                        },
                        {
                          "columnMatch": "DeviceName",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "35ch"
                          }
                        },
                        {
                          "columnMatch": "ActionType",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "contains",
                                "thresholdValue": "Failed",
                                "representation": "2",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "contains",
                                "thresholdValue": "Other",
                                "representation": "unknown",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "contains",
                                "thresholdValue": "Detect",
                                "representation": "4",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ],
                            "customColumnWidthSetting": "28ch"
                          }
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "TimeGenerated",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "TimeGenerated",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "DeviceIDs",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "AV Activity by Device (30 Days)",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let DeviceIDs = dynamic([{DeviceIDs}]);\r\nDeviceEvents\r\n| where DeviceId in (DeviceIDs)\r\n| where  ActionType == \"TamperingAttempt\"\r\n| extend ScanType = AdditionalFields.ScanTypeIndex \r\n| extend TamperingAction = AdditionalFields.TamperingAction\r\n| extend ErrorCode = AdditionalFields.ErrorCode\r\n| extend ErrorDescription = AdditionalFields.ErrorDescription\r\n| extend IsPassiveMode = AdditionalFields.IsPassiveMode\r\n| extend ThreatName = AdditionalFields.ThreatName\r\n| extend WasExecutingWhileDetected = AdditionalFields.WasExecutingWhileDetected\r\n| extend WasRemediated = AdditionalFields.WasRemediated\r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), DeviceName, ActionType, TamperingAction, RegistryKey\r\n| sort by TimeGenerated desc \r\n| sort by ActionType asc\r\n\r\n",
                    "size": 1,
                    "showAnalytics": true,
                    "title": "AV Tamper Logs by Device (30 Days) ",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "TimeGenerated",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "20ch"
                          }
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "TimeGenerated",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "TimeGenerated",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "DeviceIDs",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "AV Tamper Logs by Device (30 Days) ",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let DeviceIDs = dynamic([{DeviceIDs}]);\r\nDeviceEvents\r\n| where DeviceId in (DeviceIDs)\r\n| where ActionType startswith \"Asr\" or ActionType startswith \"Control\" \r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), DeviceName, ActionType, FileName, FolderPath, InitiatingProcessCommandLine, InitiatingProcessFileName\r\n| sort by TimeGenerated desc \r\n\r\n",
                    "size": 1,
                    "title": "ASR Rule Activity by Device (30 Days)",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "TimeGenerated",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "20ch"
                          }
                        },
                        {
                          "columnMatch": "ActionType",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "contains",
                                "thresholdValue": "Blocked",
                                "representation": "red",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "TimeGenerated",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "TimeGenerated",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "DeviceIDs",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "ASR Rule Activity by Device (30 Days)",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let DeviceIDs = dynamic([{DeviceIDs}]);\r\nDeviceEvents\r\n| where DeviceId in (DeviceIDs)\r\n| where ActionType startswith \"Net\" or ActionType startswith \"Smart\" or ActionType startswith \"Remote\" or ActionType startswith \"Fire\"\r\n| extend Protocol= AdditionalFields.Protocol\r\n| extend Reason = AdditionalFields.Experience\r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), DeviceName, ActionType, Protocol, LocalIP, LocalPort, RemoteIP, RemotePort, RemoteUrl,Reason, InitiatingProcessCommandLine\r\n| sort by TimeGenerated desc \r\n\r\n",
                    "size": 1,
                    "showAnalytics": true,
                    "title": "RDP, Firewall, & SmartScreen by Device (30 Days)",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "TimeGenerated",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "20ch"
                          }
                        },
                        {
                          "columnMatch": "DeviceName",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "40ch"
                          }
                        },
                        {
                          "columnMatch": "ActionType",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "28ch"
                          }
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "TimeGenerated",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "TimeGenerated",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "DeviceIDs",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "RDP, Firewall, & SmartScreen by Device (30 Days)",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let DeviceIDs = dynamic([{DeviceIDs}]);\r\nDeviceEvents\r\n| where DeviceId in (DeviceIDs)\r\n| where ActionType startswith \"PnP\" or ActionType startswith \"Usb\" or ActionType startswith \"Driver\"\r\n| extend USB_Drive = AdditionalFields.DriveLetter\r\n| extend USB_Manufacturer = AdditionalFields.Manufacturer\r\n| extend USB_Desc =AdditionalFields.ProductName\r\n| extend User = AdditionalFields.LoggedOnUsers\r\n| extend PnP_CLass =AdditionalFields.ClassName\r\n| extend PnP_Desc =AdditionalFields.DeviceDescription\r\n| project TimeGenerated, DeviceName, ActionType, FileName, FolderPath, User, USB_Drive, USB_Desc, USB_Manufacturer, PnP_CLass, PnP_Desc\r\n| where PnP_CLass !in (\"HIDClass\", \"SmartCard\", \"SmartCardReader\", \"Keyboard\", \"Mouse\", \"Monitor\", \"Printer\", \"AudioEndpoint\", \"PrintQueue\")\r\n| where FileName !in (\"tunnel.sys\", \"urfltv64.sys\")\r\n| where USB_Desc !contains \"DVD\"\r\n| sort by TimeGenerated desc \r\n\r\n",
                    "size": 1,
                    "showAnalytics": true,
                    "title": "Driver & Media Activity by Device (30 Days)",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "TimeGenerated",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "15.8571ch"
                          }
                        },
                        {
                          "columnMatch": "DeviceName",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "18ch"
                          }
                        },
                        {
                          "columnMatch": "ActionType",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "13ch"
                          }
                        },
                        {
                          "columnMatch": "FileName",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "18.4286ch"
                          }
                        },
                        {
                          "columnMatch": "FolderPath",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "20ch"
                          }
                        },
                        {
                          "columnMatch": "User",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "10ch"
                          }
                        },
                        {
                          "columnMatch": "USB_Drive",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "15ch"
                          }
                        },
                        {
                          "columnMatch": "USB_Desc",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "14ch"
                          }
                        },
                        {
                          "columnMatch": "USB_Manufacturer",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "22ch"
                          }
                        },
                        {
                          "columnMatch": "PnP_CLass",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "21ch"
                          }
                        },
                        {
                          "columnMatch": "PnP_Desc",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "38ch"
                          }
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "TimeGenerated",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "TimeGenerated",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "DeviceIDs",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "Driver & Media Activity by Device (30 Days)",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let DeviceIDs = dynamic([{DeviceIDs}]);\r\nDeviceEvents\r\n| where DeviceId in (DeviceIDs)\r\n| where ActionType == \"PowerShellCommand\"\r\n| extend Command = AdditionalFields.Command\r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), DeviceName, InitiatingProcessAccountName, InitiatingProcessParentFileName,InitiatingProcessCommandLine, Command\r\n| where InitiatingProcessAccountName != \"system\"\r\n| sort by TimeGenerated desc\r\n\r\n",
                    "size": 1,
                    "showAnalytics": true,
                    "title": "PowerShell Activity by Device (30 Days)",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "TimeGenerated",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "16.1429ch"
                          }
                        },
                        {
                          "columnMatch": "DeviceName",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "18.5714ch"
                          }
                        },
                        {
                          "columnMatch": "InitiatingProcessAccountName",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "21.5714ch"
                          }
                        },
                        {
                          "columnMatch": "InitiatingProcessParentFileName",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "20.4286ch"
                          }
                        },
                        {
                          "columnMatch": "InitiatingProcessCommandLine",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "46.7143ch"
                          }
                        },
                        {
                          "columnMatch": "Command",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "46.7143ch"
                          }
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "TimeGenerated",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "TimeGenerated",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "DeviceIDs",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "PowerShell Activity by Device (30 Days)",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let DeviceIDs = dynamic([{DeviceIDs}]);\r\nDeviceEvents\r\n| where DeviceId in (DeviceIDs)\r\n| where ActionType in (\"ProcessPrimaryTokenModified\",\r\n\"ScheduledTaskCreated\",\r\n\"ScheduledTaskDeleted\",\r\n\"ScheduledTaskUpdated\",\r\n\"ScriptContent\",\r\n\"SecurityGroupCreated\",\r\n\"SecurityGroupDeleted\",\r\n\"SecurityLogCleared\",\r\n\"ServiceInstalled\",\r\n\"UserAccountAddedToLocalGroup\",\r\n\"UserAccountCreated\",\r\n\"UserAccountDeleted\",\r\n\"UserAccountModified\",\r\n\"UserAccountRemovedFromLocalGroup\",\r\n\"AuditPolicyModification\")\r\n| extend SubjectUserName = AdditionalFields.SubjectUserName\r\n| extend TaskName = AdditionalFields.TaskName\r\n| extend TokenChangeDescription = parse_json(tostring(AdditionalFields.TokenModificationProperties)).tokenChangeDescription\r\n| extend ScriptContent = AdditionalFields.ScriptContent\r\n| extend GroupName = AdditionalFields.GroupName\r\n| extend ServiceName = AdditionalFields.ServiceName\r\n| extend ServiceStartType = AdditionalFields.ServiceStartType\r\n| extend SamAccountName = AdditionalFields.SamAccountName\r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), DeviceName, ActionType, AccountName, SamAccountName, TaskName, SubjectUserName, InitiatingProcessFileName, InitiatingProcessCommandLine, TokenChangeDescription, GroupName, ServiceName, ServiceStartType, IsProcessRemoteSession, ScriptContent\r\n| sort by TimeGenerated desc \r\n\r\n",
                    "size": 1,
                    "showAnalytics": true,
                    "title": "Potential Persistence Activity by Device (30 Days)",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "TimeGenerated",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "20ch"
                          }
                        },
                        {
                          "columnMatch": "DeviceName",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "40ch"
                          }
                        },
                        {
                          "columnMatch": "ActionType",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "28ch"
                          }
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "TimeGenerated",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "TimeGenerated",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "DeviceIDs",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "Potential Persistence Activity by Device (30 Days)",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "97fed9da-7456-4873-9304-8e11a40da8c4",
                        "version": "KqlParameterItem/1.0",
                        "name": "Actions",
                        "label": "Extened Actions Filter",
                        "type": 2,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "query": "union isfuzzy=true withsource=\"SourceTable\" DeviceFileEvents, DeviceImageLoadEvents, DeviceLogonEvents, DeviceNetworkEvents, \r\nDeviceProcessEvents, DeviceRegistryEvents\r\n| where TimeGenerated > ago(30d)\r\n| summarize by ActionType\r\n| sort by ActionType asc ",
                        "typeSettings": {
                          "additionalResourceOptions": [
                            "value::all"
                          ],
                          "showDefault": false
                        },
                        "timeContext": {
                          "durationMs": 86400000
                        },
                        "defaultValue": "value::all",
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "conditionalVisibility": {
                    "parameterName": "DeviceIDs",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "parameters - 8"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let DeviceIDs = dynamic([{DeviceIDs}]);\r\nlet Actions = dynamic([{Actions}]);\r\nunion isfuzzy=true withsource=\"SourceTable\" DeviceFileEvents, DeviceImageLoadEvents, DeviceLogonEvents, DeviceNetworkEvents, \r\nDeviceProcessEvents, DeviceRegistryEvents\r\n| where DeviceId in (DeviceIDs)\r\n| where ActionType in (Actions)\r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), DeviceName, ActionType, SourceTable, AdditionalFields, InitiatingProcessAccountName, InitiatingProcessCommandLine, InitiatingProcessFolderPath, InitiatingProcessParentFileName, Protocol, RemoteIP, RemotePort, LocalIP, LocalPort, RemoteUrl\r\n| sort by TimeGenerated desc \r\n\r\n",
                    "size": 1,
                    "showAnalytics": true,
                    "title": "Extended Actions by Device (30 days)",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "TimeGenerated",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "20ch"
                          }
                        },
                        {
                          "columnMatch": "DeviceName",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "40ch"
                          }
                        },
                        {
                          "columnMatch": "ActionType",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "28ch"
                          }
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "TimeGenerated",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "TimeGenerated",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "DeviceIDs",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "Extended Actions by Device (30 days)",
                  "styleSettings": {
                    "showBorder": true
                  }
                }
              ]
            },
            "name": "Device Tables"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let DeviceIDs = dynamic([{DeviceIDs}]);\r\nDeviceEvents\r\n| where DeviceId in (DeviceIDs)\r\n| where ActionType startswith \"AppControl\"\r\n| where ActionType !in (\"AppControlCodeIntegrityPolicyLoaded\", \"AppControlCodeIntegritySigningInformation\", \"AppControlPolicyApplied\")\r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), DeviceName, ActionType, IsRemoteSession = IsProcessRemoteSession, FileName, FolderPath, InitiatingProcessCommandLine, InitiatingProcessFileName\r\n| sort by TimeGenerated desc \r\n\r\n",
              "size": 1,
              "showAnalytics": true,
              "title": "App Control Activity by Device (30 days)",
              "timeContext": {
                "durationMs": 2592000000
              },
              "showRefreshButton": true,
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "TimeGenerated",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  },
                  {
                    "columnMatch": "DeviceName",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "40ch"
                    }
                  },
                  {
                    "columnMatch": "ActionType",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "28ch"
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "TimeGenerated",
                    "sortOrder": 2
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "TimeGenerated",
                  "sortOrder": 2
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "DeviceIDs",
              "comparison": "isNotEqualTo"
            },
            "name": "App Control Activity by Device (30 days)",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let Sentinel_ID = dynamic([{Sentinel_ID}]);\r\nSecurityIncident\r\n| where IncidentNumber in (Sentinel_ID)\r\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\r\n| mvexpand todynamic(AlertIds)\r\n| extend SystemAlertId = tostring(AlertIds)\r\n| join SecurityAlert on SystemAlertId\r\n| project Expand = parse_json(Entities)\r\n| mvexpand Expand\r\n| extend Type = tostring(Expand.Type)\r\n| where Type == \"file\" or Type == \"filehash\"\r\n| extend Verdict = tostring(Expand.LastVerdict)\r\n| extend FileName = tostring(Expand.Name)\r\n| extend Sid = tostring(Expand.Sid)\r\n| extend Type = tostring(Expand.Type)\r\n| extend ThreatAnalysisSummary = Expand.ThreatAnalysisSummary\r\n| extend Algorithm = tostring(Expand.Algorithm)\r\n| extend Hash = tostring(Expand.Value)\r\n| extend LastSeen = tostring(Expand.LastSeen)\r\n| extend Directory = tostring(Expand.Directory)\r\n| extend AnalyzersResult = tostring(Expand.AnalyzersResult)\r\n| extend ScanDate = todatetime(ThreatAnalysisSummary[0].AnalysisDate)\r\n| join AlertEvidence on FileName\r\n| extend Category = parse_json(Categories)[0]\r\n| extend Algorithm = iif(isempty(Algorithm), \"SHA1\", Algorithm)\r\n| extend Hash = iif(isempty(Hash), SHA1, Algorithm)\r\n| extend DetectionStatus = AdditionalFields.DetectionStatus\r\n| extend LastVerdict = AdditionalFields.LastVerdict\r\n| extend SuspicionLevel = AdditionalFields.SuspicionLevel\r\n| extend HostName = parse_json(tostring(AdditionalFields.Host)).HostName\r\n| summarize arg_max(TimeGenerated, *) by Hash, tostring(HostName)\r\n| project TimeGenerated, Type, FileName, HostName, Directory, SuspicionLevel, Category, ThreatFamily, DetectionStatus, LastVerdict, Algorithm, Hash, RelatedAlert=Title\r\n| join DeviceEvents on $left.Hash == $right.SHA1\r\n| extend ThreatName = AdditionalFields.ThreatName\r\n| extend WasExecutingWhileDetected = AdditionalFields.WasExecutingWhileDetected\r\n| extend WasRemediated = AdditionalFields.WasRemediated\r\n| extend IsPassiveMode = AdditionalFields.IsPassiveMode\r\n| where isnotempty(IsPassiveMode)\r\n| summarize arg_max(TimeGenerated, *) by Hash, tostring(HostName)\r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), Type, FileName, Directory, HostName, IsPassiveMode, WasRemediated, SuspicionLevel, Category, ThreatName, ThreatFamily, DetectionStatus, LastVerdict, WasExecutingWhileDetected, Algorithm, Hash, RelatedAlert\r\n| sort by TimeGenerated desc",
              "size": 1,
              "showAnalytics": true,
              "title": "File & Hash Entity Deep Dive",
              "noDataMessage": "Selected incident(s) have no linked file entities.",
              "timeContextFromParameter": "TimeRange",
              "showRefreshButton": true,
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "TimeGenerated",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "Directory",
                    "sortOrder": 1
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "Directory",
                  "sortOrder": 1
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "Sentinel_ID",
              "comparison": "isNotEqualTo"
            },
            "name": "File & Hash Entity Deep Dive",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let Sentinel_ID = dynamic([{Sentinel_ID}]);\r\nSecurityIncident\r\n| where IncidentNumber in (Sentinel_ID)\r\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\r\n| mvexpand todynamic(AlertIds)\r\n| extend SystemAlertId = tostring(AlertIds)\r\n| join SecurityAlert on SystemAlertId\r\n| extend Expand = parse_json(Entities)\r\n| mvexpand Expand\r\n| extend Type = tostring(Expand.Type)\r\n| where Type == \"url\"\r\n| extend Source = Expand.Source\r\n| extend FirstSeen = todatetime(Expand.FirstSeen)\r\n| extend Url = tostring(Expand.Url)\r\n| extend ClickCount = tostring(Expand.ClickCount)\r\n| extend EmailCount = tostring(Expand.EmailCount)\r\n| summarize arg_max(TimeGenerated, *) by Url\r\n| project TimeGenerated, Url, Tactics, ClickCount, EmailCount,AlertName, AlertSeverity\r\n| sort by TimeGenerated desc\r\n",
              "size": 1,
              "showAnalytics": true,
              "title": "Select URL(s) to Expand",
              "noDataMessage": "Selected incident(s) have no linked URL entities.",
              "timeContext": {
                "durationMs": 2592000000
              },
              "showRefreshButton": true,
              "exportMultipleValues": true,
              "exportedParameters": [
                {
                  "fieldName": "Url",
                  "parameterName": "URL",
                  "parameterType": 1
                }
              ],
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "TimeGenerated",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "17.1429ch"
                    }
                  },
                  {
                    "columnMatch": "Url",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "60.5714ch"
                    }
                  },
                  {
                    "columnMatch": "Tactics",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "16.1429ch"
                    }
                  },
                  {
                    "columnMatch": "ClickCount",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "13.4286ch"
                    }
                  },
                  {
                    "columnMatch": "EmailCount",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "13ch"
                    }
                  },
                  {
                    "columnMatch": "AlertName",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "39.8571ch"
                    }
                  },
                  {
                    "columnMatch": "AlertSeverity",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "19ch"
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              },
              "sortBy": []
            },
            "conditionalVisibility": {
              "parameterName": "Sentinel_ID",
              "comparison": "isNotEqualTo"
            },
            "name": "Select URL(s) to Expand",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let URL = dynamic([{URL}]);\r\nunion isfuzzy=true withsource=Table DeviceFileEvents, DeviceEvents, DeviceNetworkEvents, OfficeActivity, ThreatIntelligenceIndicator, UrlClickEvents\r\n| where isnotempty(Url) or isnotempty(RemoteUrl) or isnotempty(RemoteUrl) or isnotempty(FileOriginUrl)\r\n| extend Url =  iif(isnotempty(RemoteUrl), RemoteUrl, Url)\r\n| extend Url =  iif(isnotempty(Site_Url), Site_Url, Url)\r\n| extend Url =  iif(isnotempty(FileOriginUrl), FileOriginUrl, Url)\r\n| where Url in (URL)\r\n| extend AccountUpn = iif(isnotempty(UserId), UserId, AccountUpn)\r\n| extend Workload = iif(isnotempty(OfficeWorkload), OfficeWorkload, Workload)\r\n| extend ActionType = iif(isnotempty(ThreatType), \"ThreatType\", ActionType)\r\n| extend ActionType = iif(Table == \"OfficeActivity\", \"OfficeActivity\", ActionType)\r\n| project TimeGenerated, Table, ActionType, Url, AccountUpn, Workload, IPAddress, DeviceName, DeviceId, InitiatingProcessVersionInfoFileDescription, FileName, SHA1, LocalIPType, ThreatType\r\n| sort by TimeGenerated desc \r\n\r\n",
              "size": 1,
              "showAnalytics": true,
              "title": "URL Hunt in Related Logs (30 Days)",
              "timeContext": {
                "durationMs": 2592000000
              },
              "showRefreshButton": true,
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "TimeGenerated",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "15.7131ch"
                    }
                  },
                  {
                    "columnMatch": "DeviceName",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "20.142ch"
                    }
                  },
                  {
                    "columnMatch": "ActionType",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "21.7134ch"
                    }
                  },
                  {
                    "columnMatch": "AccountName",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "13.9997ch"
                    }
                  },
                  {
                    "columnMatch": "SamAccountName",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "11.5714ch"
                    }
                  },
                  {
                    "columnMatch": "TaskName",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "33.5714ch"
                    }
                  },
                  {
                    "columnMatch": "SubjectUserName",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "21ch"
                    }
                  },
                  {
                    "columnMatch": "InitiatingProcessFileName",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "22.2854ch"
                    }
                  },
                  {
                    "columnMatch": "InitiatingProcessCommandLine",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "22.8571ch"
                    }
                  },
                  {
                    "columnMatch": "TokenChangeDescription",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "19.8571ch"
                    }
                  },
                  {
                    "columnMatch": "GroupName",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "20.9994ch"
                    }
                  },
                  {
                    "columnMatch": "ServiceName",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "23.7131ch"
                    }
                  },
                  {
                    "columnMatch": "ServiceStartType",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "22ch"
                    }
                  },
                  {
                    "columnMatch": "IsProcessRemoteSession",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "28ch"
                    }
                  },
                  {
                    "columnMatch": "ScriptContent",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "19ch"
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "TimeGenerated",
                    "sortOrder": 2
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "TimeGenerated",
                  "sortOrder": 2
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "URL",
              "comparison": "isNotEqualTo"
            },
            "name": "URL Hunt in Related Logs (30 Days)",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let Sentinel_ID = dynamic([{Sentinel_ID}]);\r\nSecurityIncident\r\n| where IncidentNumber in (Sentinel_ID)\r\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\r\n| mvexpand todynamic(AlertIds)\r\n| extend SystemAlertId = tostring(AlertIds)\r\n| join SecurityAlert on SystemAlertId\r\n| extend Expand = parse_json(Entities)\r\n| mvexpand Expand\r\n| extend Type = tostring(Expand.Type)\r\n| where Type == \"ip\"\r\n| extend Address = tostring(Expand.Address)\r\n| extend Verdict = tostring(Expand.LastVerdict)\r\n| extend Role = parse_json(tostring(Expand.Roles))[0]\r\n| extend Latitude = tostring(Expand.Location.Latitude)\r\n| extend Longitude = tostring(Expand.Location.Longitude)\r\n| extend Is_Private = ipv4_is_private(Address)\r\n//| extend Location = geo_info_from_ip_address(Address)\r\n| extend City = tostring(Expand.Location.City)\r\n| extend State = tostring(Expand.Location.State)\r\n| extend CountryCode = tostring(Expand.Location.CountryCode)\r\n| project TimeGenerated, Address, Verdict, Role, Is_Private, City, State, CountryCode, Longitude, Latitude, AlertName, AlertSeverity\r\n",
              "size": 1,
              "showAnalytics": true,
              "title": "Expand Entities - IPs",
              "noDataMessage": "Selected incident(s) have no linked IP address entities.",
              "timeContext": {
                "durationMs": 2592000000
              },
              "showRefreshButton": true,
              "exportedParameters": [
                {
                  "fieldName": "Latitude",
                  "parameterName": "Latitude",
                  "parameterType": 1
                },
                {
                  "fieldName": "Longitude",
                  "parameterName": "Longitude",
                  "parameterType": 1
                }
              ],
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "TimeGenerated",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "17ch"
                    }
                  },
                  {
                    "columnMatch": "Address",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "16.2857ch"
                    }
                  },
                  {
                    "columnMatch": "Verdict",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "13ch"
                    }
                  },
                  {
                    "columnMatch": "Role",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "10ch"
                    }
                  },
                  {
                    "columnMatch": "Is_Private",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "16ch"
                    }
                  },
                  {
                    "columnMatch": "City",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "10ch"
                    }
                  },
                  {
                    "columnMatch": "State",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "11ch"
                    }
                  },
                  {
                    "columnMatch": "CountryCode",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "17ch"
                    }
                  },
                  {
                    "columnMatch": "Longitude",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "Latitude",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "14ch"
                    }
                  },
                  {
                    "columnMatch": "AlertName",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "35.7143ch"
                    }
                  },
                  {
                    "columnMatch": "AlertSeverity",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "19ch"
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              },
              "sortBy": []
            },
            "conditionalVisibility": {
              "parameterName": "Sentinel_ID",
              "comparison": "isNotEqualTo"
            },
            "name": "Expand Entities - IPs (Select for Map)",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let Sentinel_ID = dynamic([{Sentinel_ID}]);\r\nSecurityIncident\r\n| where IncidentNumber in (Sentinel_ID)\r\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\r\n| mvexpand todynamic(AlertIds)\r\n| extend SystemAlertId = tostring(AlertIds)\r\n| join SecurityAlert on SystemAlertId\r\n| project Expand = parse_json(Entities)\r\n| mvexpand Expand\r\n| extend Type = tostring(Expand.Type)\r\n| where Type == \"ip\"\r\n| extend AccountName = tostring(Expand.AccountName)\r\n| extend DomainName = tostring(Expand.DomainName)\r\n| extend IsDomainJoined = tostring(Expand.IsDomainJoined)\r\n| extend Verdict = tostring(Expand.LastVerdict)\r\n| extend Name = tostring(Expand.Name)\r\n| extend p6 = tostring(Expand.Sid)\r\n| extend Type = tostring(Expand.Type)\r\n| extend p8 = tostring(Expand.UPNSuffix)\r\n| extend p9 = tostring(Expand.UserPrincipalName)\r\n| extend p10 = Expand.ThreatAnalysisSummary\r\n| extend ResourceName = tostring(Expand.ResourceName)\r\n| extend ResourceType = tostring(Expand.ResourceType)\r\n| extend Algorithm = tostring(Expand.Algorithm)\r\n| extend Value = tostring(Expand.Value)\r\n| extend AadDeviceId = tostring(Expand.AadDeviceId)\r\n| extend AvStatus = tostring(Expand.AvStatus)\r\n| extend DnsDomain = tostring(Expand.DnsDomain)\r\n| extend FQDN = tostring(Expand.FQDN)\r\n| extend HealthStatus = tostring(Expand.HealthStatus)\r\n| extend LastIpAddress = tostring(Expand.LastIpAddress)\r\n| extend ExternalIpAddress = tostring(Expand.LastExternalIpAddress)\r\n| extend LoggedOnUsers = tostring(Expand.LoggedOnUsers)\r\n| extend HostName = tostring(Expand.HostName)\r\n| extend LastSeen = tostring(Expand.LastSeen)\r\n| extend DeviceId = tostring(Expand.MdatpDeviceId)\r\n| extend OSFamily = tostring(Expand.OSFamily)\r\n| extend OnboardingStatus = tostring(Expand.OnboardingStatus)\r\n| extend RiskScore = tostring(Expand.RiskScore)\r\n| extend Address = tostring(Expand.Address)\r\n| extend Location = tostring(Expand.Location)\r\n| extend City = tostring(Expand.Location.City)\r\n| extend State = tostring(Expand.Location.State)\r\n| extend CountryCode = tostring(Expand.Location.CountryCode)\r\n| extend Latitude = tostring(Expand.Location.Latitude)\r\n| extend Longitude = tostring(Expand.Location.Longitude)\r\n| extend CommandLine = tostring(Expand.CommandLine)\r\n| extend FriendlyName = tostring(Expand.FriendlyName)\r\n| extend ProcessId = tostring(Expand.ProcessId)\r\n| extend Directory = tostring(Expand.Directory)\r\n| extend AnalyzersResult = tostring(Expand.AnalyzersResult)\r\n| project Address, City, State, Country=CountryCode, Latitude, Longitude\r\n",
              "size": 3,
              "title": "Expand Entities - IP Map",
              "noDataMessage": "Selected incident(s) have no linked IP address entities.",
              "timeContext": {
                "durationMs": 2592000000
              },
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "visualization": "map",
              "gridSettings": {
                "rowLimit": 10000
              },
              "sortBy": [],
              "mapSettings": {
                "locInfo": "LatLong",
                "latitude": "Latitude",
                "longitude": "Longitude",
                "sizeSettings": "Address",
                "sizeAggregation": "Sum",
                "legendAggregation": "Sum",
                "itemColorSettings": null
              }
            },
            "conditionalVisibility": {
              "parameterName": "Longitude",
              "comparison": "isNotEqualTo"
            },
            "name": "Expand Entities - IP Map",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let Sentinel_ID = dynamic([{Sentinel_ID}]);\r\nSecurityIncident\r\n| where IncidentNumber in (Sentinel_ID)\r\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\r\n| mvexpand todynamic(AlertIds)\r\n| extend SystemAlertId = tostring(AlertIds)\r\n| join SecurityAlert on SystemAlertId\r\n| extend Expand = parse_json(Entities)\r\n| mvexpand Expand\r\n| extend Type = tostring(Expand.Type)\r\n| where Type == \"process\"\r\n| extend CommandLine = tostring(Expand.CommandLine)\r\n| extend FriendlyName = tostring(Expand.FriendlyName)\r\n| extend ProcessId = tostring(Expand.ProcessId)\r\n| extend Directory = tostring(Expand.Directory)\r\n| extend AnalyzersResult = tostring(Expand.AnalyzersResult)\r\n| extend ParentProcess = parse_json(tostring(Expand.ParentProcess)).FriendlyName\r\n| extend FriendlyName = iff(isempty( FriendlyName), \"unknown\", FriendlyName)\r\n| extend SHA1 = parse_json(tostring(parse_json(tostring(Expand.ImageFile)).FileHashes))[0].Value\r\n| extend Directory = parse_json(tostring(Expand.ImageFile)).Directory\r\n| extend ImageFile = parse_json(tostring(Expand.ImageFile)).Name\r\n| summarize arg_max(TimeGenerated, *) by CommandLine, ProcessId\r\n| project TimeGenerated, FriendlyName, Tactics, ProcessId, CommandLine, ParentProcess, Directory, ImageFile, SHA1, AlertName, AlertSeverity\r\n| sort by TimeGenerated desc\r\n",
              "size": 1,
              "showAnalytics": true,
              "title": "Expand Entities - Services, Processes, & Tasks",
              "noDataMessage": "Selected incident(s) have no linked process entities.",
              "timeContext": {
                "durationMs": 2592000000
              },
              "showRefreshButton": true,
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "TimeGenerated",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "18.2857ch"
                    }
                  },
                  {
                    "columnMatch": "FriendlyName",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "18ch"
                    }
                  },
                  {
                    "columnMatch": "Tactics",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "24.5714ch"
                    }
                  },
                  {
                    "columnMatch": "ProcessId",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "CommandLine",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "35.4286ch"
                    }
                  },
                  {
                    "columnMatch": "ParentProcess",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "19ch"
                    }
                  },
                  {
                    "columnMatch": "Directory",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "34ch"
                    }
                  },
                  {
                    "columnMatch": "ImageFile",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "18ch"
                    }
                  },
                  {
                    "columnMatch": "SHA1",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "33.2857ch"
                    }
                  },
                  {
                    "columnMatch": "AlertName",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "40.7143ch"
                    }
                  },
                  {
                    "columnMatch": "AlertSeverity",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "19ch"
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              },
              "sortBy": []
            },
            "conditionalVisibility": {
              "parameterName": "Sentinel_ID",
              "comparison": "isNotEqualTo"
            },
            "name": "Expand Entities - Services, Processes, & Tasks",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "Main"
      },
      "name": "Incident Group"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Device Explorer",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "Search for MDE device(s) by name or other related criteria. Must use full name or wildcard(*).",
              "style": "success"
            },
            "name": "text - 0"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "e11071d0-c113-4b4b-ae6a-4dd1340baadc",
                  "version": "KqlParameterItem/1.0",
                  "name": "DeviceSearch",
                  "label": "Device Search",
                  "type": 1,
                  "typeSettings": {
                    "isSearchBox": true
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  },
                  "value": "ywhgw-5p2010026"
                }
              ],
              "style": "formVertical",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - 13 - Copy - Copy"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let DeviceSearch = \"{DeviceSearch}\";\r\nDeviceInfo\r\n| where TimeGenerated > ago(90d)\r\n| summarize arg_max(TimeGenerated, *) by DeviceId\r\n| search DeviceName: DeviceSearch\r\n| project LastRecorded=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), DeviceName, MDE_DeviceId=DeviceId, IsAzureADJoined, LoggedOnUsers, PublicIP, AadDeviceId, DeviceType, JoinType, OnboardingStatus, SensorHealthState, OSDistribution, IsExcluded, ExposureLevel, MachineGroup, DeviceManualTags, DeviceDynamicTags, RegistryDeviceTag\r\n",
              "size": 1,
              "title": "Device Search Results",
              "timeContext": {
                "durationMs": 2592000000
              },
              "showRefreshButton": true,
              "exportMultipleValues": true,
              "exportedParameters": [
                {
                  "fieldName": "MDE_DeviceId",
                  "parameterName": "DeviceIDs",
                  "parameterType": 1
                },
                {
                  "fieldName": "DeviceName",
                  "parameterName": "DeviceName",
                  "parameterType": 1
                }
              ],
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "sortBy": []
            },
            "name": "Device Search",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let DeviceIDs = dynamic([{DeviceIDs}]);\r\nDeviceEvents\r\n| where DeviceId in (DeviceIDs)\r\n| where ActionType startswith \"Antivirus\" or ActionType == \"OtherAlertRelatedActivity\"\r\n| extend ScanType = AdditionalFields.ScanTypeIndex \r\n| extend TamperingAction = AdditionalFields.TamperingAction\r\n| extend ErrorCode = AdditionalFields.ErrorCode\r\n| extend ErrorDescription = AdditionalFields.ErrorDescription\r\n| extend IsPassiveMode = AdditionalFields.IsPassiveMode\r\n| extend ThreatName = AdditionalFields.ThreatName\r\n| extend WasExecutingWhileDetected = AdditionalFields.WasExecutingWhileDetected\r\n| extend WasRemediated = AdditionalFields.WasRemediated\r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), DeviceName, ActionType, ScanType, ThreatName, WasRemediated, FileName, FolderPath, SHA1, IsPassiveMode, WasExecutingWhileDetected, ErrorCode, ErrorDescription, AdditionalFields\r\n| sort by TimeGenerated desc \r\n| sort by ActionType asc\r\n\r\n",
                    "size": 1,
                    "showAnalytics": true,
                    "title": "AV Activity by Device (30 Days)",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "TimeGenerated",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "20ch"
                          }
                        },
                        {
                          "columnMatch": "DeviceName",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "35ch"
                          }
                        },
                        {
                          "columnMatch": "ActionType",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "icons",
                            "thresholdsGrid": [
                              {
                                "operator": "contains",
                                "thresholdValue": "Failed",
                                "representation": "2",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "contains",
                                "thresholdValue": "Other",
                                "representation": "unknown",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "contains",
                                "thresholdValue": "Detect",
                                "representation": "4",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "representation": "success",
                                "text": "{0}{1}"
                              }
                            ],
                            "customColumnWidthSetting": "28ch"
                          }
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "TimeGenerated",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "TimeGenerated",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "DeviceIDs",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "AV Activity by Device (30 Days)",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let DeviceIDs = dynamic([{DeviceIDs}]);\r\nDeviceEvents\r\n| where DeviceId in (DeviceIDs)\r\n| where  ActionType == \"TamperingAttempt\"\r\n| extend ScanType = AdditionalFields.ScanTypeIndex \r\n| extend TamperingAction = AdditionalFields.TamperingAction\r\n| extend ErrorCode = AdditionalFields.ErrorCode\r\n| extend ErrorDescription = AdditionalFields.ErrorDescription\r\n| extend IsPassiveMode = AdditionalFields.IsPassiveMode\r\n| extend ThreatName = AdditionalFields.ThreatName\r\n| extend WasExecutingWhileDetected = AdditionalFields.WasExecutingWhileDetected\r\n| extend WasRemediated = AdditionalFields.WasRemediated\r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), DeviceName, ActionType, TamperingAction, RegistryKey\r\n| sort by TimeGenerated desc \r\n| sort by ActionType asc\r\n\r\n",
                    "size": 1,
                    "showAnalytics": true,
                    "title": "AV Tamper Logs by Device (30 Days) ",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "TimeGenerated",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "20ch"
                          }
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "TimeGenerated",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "TimeGenerated",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "DeviceIDs",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "AV Tamper Logs by Device (30 Days) ",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let DeviceIDs = dynamic([{DeviceIDs}]);\r\nDeviceEvents\r\n| where DeviceId in (DeviceIDs)\r\n| where ActionType startswith \"Asr\" or ActionType startswith \"Control\" \r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), DeviceName, ActionType, FileName, FolderPath, InitiatingProcessCommandLine, InitiatingProcessFileName\r\n| sort by TimeGenerated desc \r\n\r\n",
                    "size": 1,
                    "showAnalytics": true,
                    "title": "ASR Rule Activity by Device (30 Days)",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "TimeGenerated",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "20ch"
                          }
                        },
                        {
                          "columnMatch": "ActionType",
                          "formatter": 18,
                          "formatOptions": {
                            "thresholdsOptions": "colors",
                            "thresholdsGrid": [
                              {
                                "operator": "contains",
                                "thresholdValue": "Blocked",
                                "representation": "red",
                                "text": "{0}{1}"
                              },
                              {
                                "operator": "Default",
                                "thresholdValue": null,
                                "text": "{0}{1}"
                              }
                            ]
                          }
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "TimeGenerated",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "TimeGenerated",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "DeviceIDs",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "ASR Rule Activity by Device (30 Days)",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let DeviceIDs = dynamic([{DeviceIDs}]);\r\nDeviceEvents\r\n| where DeviceId in (DeviceIDs)\r\n| where ActionType startswith \"Net\" or ActionType startswith \"Smart\" or ActionType startswith \"Remote\" or ActionType startswith \"Fire\"\r\n| extend Protocol= AdditionalFields.Protocol\r\n| extend Reason = AdditionalFields.Experience\r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), DeviceName, ActionType, Protocol, LocalIP, LocalPort, RemoteIP, RemotePort, RemoteUrl,Reason, InitiatingProcessCommandLine\r\n| sort by TimeGenerated desc \r\n\r\n",
                    "size": 1,
                    "showAnalytics": true,
                    "title": "RDP, Firewall, & SmartScreen by Device (30 Days)",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "TimeGenerated",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "20ch"
                          }
                        },
                        {
                          "columnMatch": "DeviceName",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "40ch"
                          }
                        },
                        {
                          "columnMatch": "ActionType",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "28ch"
                          }
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "TimeGenerated",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "TimeGenerated",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "DeviceIDs",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "RDP, Firewall, & SmartScreen by Device (30 Days)",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let DeviceIDs = dynamic([{DeviceIDs}]);\r\nDeviceEvents\r\n| where DeviceId in (DeviceIDs)\r\n| where ActionType startswith \"PnP\" or ActionType startswith \"Usb\" or ActionType startswith \"Driver\"\r\n| extend USB_Drive = AdditionalFields.DriveLetter\r\n| extend USB_Manufacturer = AdditionalFields.Manufacturer\r\n| extend USB_Desc =AdditionalFields.ProductName\r\n| extend User = AdditionalFields.LoggedOnUsers\r\n| extend PnP_CLass =AdditionalFields.ClassName\r\n| extend PnP_Desc =AdditionalFields.DeviceDescription\r\n| project TimeGenerated, DeviceName, ActionType, FileName, FolderPath, User, USB_Drive, USB_Desc, USB_Manufacturer, PnP_CLass, PnP_Desc\r\n| where PnP_CLass !in (\"HIDClass\", \"SmartCard\", \"SmartCardReader\", \"Keyboard\", \"Mouse\", \"Monitor\", \"Printer\", \"AudioEndpoint\", \"PrintQueue\")\r\n| where FileName !in (\"tunnel.sys\", \"urfltv64.sys\")\r\n| where USB_Desc !contains \"DVD\"\r\n| sort by TimeGenerated desc \r\n\r\n",
                    "size": 1,
                    "showAnalytics": true,
                    "title": "Driver & Media Activity by Device (30 Days)",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "TimeGenerated",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "15.8571ch"
                          }
                        },
                        {
                          "columnMatch": "DeviceName",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "18ch"
                          }
                        },
                        {
                          "columnMatch": "ActionType",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "13ch"
                          }
                        },
                        {
                          "columnMatch": "FileName",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "18.4286ch"
                          }
                        },
                        {
                          "columnMatch": "FolderPath",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "20ch"
                          }
                        },
                        {
                          "columnMatch": "User",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "10ch"
                          }
                        },
                        {
                          "columnMatch": "USB_Drive",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "15ch"
                          }
                        },
                        {
                          "columnMatch": "USB_Desc",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "14ch"
                          }
                        },
                        {
                          "columnMatch": "USB_Manufacturer",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "22ch"
                          }
                        },
                        {
                          "columnMatch": "PnP_CLass",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "21ch"
                          }
                        },
                        {
                          "columnMatch": "PnP_Desc",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "38ch"
                          }
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "TimeGenerated",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "TimeGenerated",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "DeviceIDs",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "Driver & Media Activity by Device (30 Days)",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let DeviceIDs = dynamic([{DeviceIDs}]);\r\nDeviceEvents\r\n| where DeviceId in (DeviceIDs)\r\n| where ActionType == \"PowerShellCommand\"\r\n| extend Command = AdditionalFields.Command\r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), DeviceName, InitiatingProcessAccountName, InitiatingProcessParentFileName,InitiatingProcessCommandLine, Command\r\n| where InitiatingProcessAccountName != \"system\"\r\n| sort by TimeGenerated desc\r\n\r\n",
                    "size": 1,
                    "showAnalytics": true,
                    "title": "PowerShell Activity by Device (30 Days)",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "TimeGenerated",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "16.1429ch"
                          }
                        },
                        {
                          "columnMatch": "DeviceName",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "18.5714ch"
                          }
                        },
                        {
                          "columnMatch": "InitiatingProcessAccountName",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "21.5714ch"
                          }
                        },
                        {
                          "columnMatch": "InitiatingProcessParentFileName",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "20.4286ch"
                          }
                        },
                        {
                          "columnMatch": "InitiatingProcessCommandLine",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "46.7143ch"
                          }
                        },
                        {
                          "columnMatch": "Command",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "46.7143ch"
                          }
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "TimeGenerated",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "TimeGenerated",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "DeviceIDs",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "PowerShell Activity by Device (30 Days)",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let DeviceIDs = dynamic([{DeviceIDs}]);\r\nDeviceEvents\r\n| where DeviceId in (DeviceIDs)\r\n| where ActionType in (\"ProcessPrimaryTokenModified\",\r\n\"ScheduledTaskCreated\",\r\n\"ScheduledTaskDeleted\",\r\n\"ScheduledTaskUpdated\",\r\n\"ScriptContent\",\r\n\"SecurityGroupCreated\",\r\n\"SecurityGroupDeleted\",\r\n\"SecurityLogCleared\",\r\n\"ServiceInstalled\",\r\n\"UserAccountAddedToLocalGroup\",\r\n\"UserAccountCreated\",\r\n\"UserAccountDeleted\",\r\n\"UserAccountModified\",\r\n\"UserAccountRemovedFromLocalGroup\",\r\n\"AuditPolicyModification\")\r\n| extend SubjectUserName = AdditionalFields.SubjectUserName\r\n| extend TaskName = AdditionalFields.TaskName\r\n| extend TokenChangeDescription = parse_json(tostring(AdditionalFields.TokenModificationProperties)).tokenChangeDescription\r\n| extend ScriptContent = AdditionalFields.ScriptContent\r\n| extend GroupName = AdditionalFields.GroupName\r\n| extend ServiceName = AdditionalFields.ServiceName\r\n| extend ServiceStartType = AdditionalFields.ServiceStartType\r\n| extend SamAccountName = AdditionalFields.SamAccountName\r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), DeviceName, ActionType, AccountName, SamAccountName, TaskName, SubjectUserName, InitiatingProcessFileName, InitiatingProcessCommandLine, TokenChangeDescription, GroupName, ServiceName, ServiceStartType, IsProcessRemoteSession, ScriptContent\r\n| sort by TimeGenerated desc \r\n\r\n",
                    "size": 1,
                    "showAnalytics": true,
                    "title": "Potential Persistence Activity by Device (30 Days)",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "TimeGenerated",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "20ch"
                          }
                        },
                        {
                          "columnMatch": "DeviceName",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "40ch"
                          }
                        },
                        {
                          "columnMatch": "ActionType",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "28ch"
                          }
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true,
                      "sortBy": [
                        {
                          "itemKey": "TimeGenerated",
                          "sortOrder": 2
                        }
                      ]
                    },
                    "sortBy": [
                      {
                        "itemKey": "TimeGenerated",
                        "sortOrder": 2
                      }
                    ]
                  },
                  "conditionalVisibility": {
                    "parameterName": "DeviceIDs",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "Potential Persistence Activity by Device (30 Days)",
                  "styleSettings": {
                    "showBorder": true
                  }
                },
                {
                  "type": 9,
                  "content": {
                    "version": "KqlParameterItem/1.0",
                    "parameters": [
                      {
                        "id": "e26a5d6a-d967-4a0f-a587-815d318ca9d5",
                        "version": "KqlParameterItem/1.0",
                        "name": "Actions",
                        "label": "Filter Extended Actions",
                        "type": 2,
                        "multiSelect": true,
                        "quote": "'",
                        "delimiter": ",",
                        "query": "union isfuzzy=true withsource=\"SourceTable\" DeviceFileEvents, DeviceImageLoadEvents, DeviceLogonEvents, DeviceNetworkEvents, \r\nDeviceProcessEvents, DeviceRegistryEvents\r\n| where TimeGenerated > ago(30d)\r\n| summarize by ActionType\r\n| sort by ActionType asc \r\n",
                        "typeSettings": {
                          "additionalResourceOptions": [
                            "value::all"
                          ],
                          "showDefault": false
                        },
                        "defaultValue": "value::all",
                        "queryType": 0,
                        "resourceType": "microsoft.operationalinsights/workspaces"
                      }
                    ],
                    "style": "pills",
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces"
                  },
                  "conditionalVisibility": {
                    "parameterName": "DeviceIDs",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "parameters - 8"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let DeviceIDs = dynamic([{DeviceIDs}]);\r\nlet Actions = dynamic([{Actions}]);\r\nunion isfuzzy=true withsource=\"SourceTable\" DeviceFileEvents, DeviceImageLoadEvents, DeviceLogonEvents, DeviceNetworkEvents, \r\nDeviceProcessEvents, DeviceRegistryEvents\r\n| where DeviceId in (DeviceIDs)\r\n| where ActionType in (Actions)\r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), DeviceName, SourceTable, ActionType, AdditionalFields, InitiatingProcessAccountName, InitiatingProcessCommandLine, InitiatingProcessFolderPath, InitiatingProcessParentFileName, Protocol, RemoteIP, RemotePort, LocalIP, LocalPort, RemoteUrl\r\n| sort by TimeGenerated desc ",
                    "size": 1,
                    "showAnalytics": true,
                    "title": "Extended Actions by Device (30 days)",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "formatters": [
                        {
                          "columnMatch": "TimeGenerated",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "20ch"
                          }
                        },
                        {
                          "columnMatch": "DeviceName",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "40ch"
                          }
                        },
                        {
                          "columnMatch": "ActionType",
                          "formatter": 0,
                          "formatOptions": {
                            "customColumnWidthSetting": "28ch"
                          }
                        }
                      ],
                      "rowLimit": 10000,
                      "filter": true
                    },
                    "sortBy": []
                  },
                  "conditionalVisibility": {
                    "parameterName": "DeviceIDs",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "Extended Actions by Device (30 days)",
                  "styleSettings": {
                    "showBorder": true
                  }
                }
              ]
            },
            "name": "Device Tables"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "Devices"
      },
      "name": "Device Explorer"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "Accounts Explorer",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "Search for user(s) by name or other related criteria. Must use full terms or wildcards (*).",
              "style": "success"
            },
            "name": "text - 14"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "8a3a7d43-a983-4326-9833-d7330151b5ba",
                  "version": "KqlParameterItem/1.0",
                  "name": "UsersSearch",
                  "label": "Account Search",
                  "type": 1,
                  "typeSettings": {
                    "isSearchBox": true
                  },
                  "timeContext": {
                    "durationMs": 86400000
                  }
                }
              ],
              "style": "formVertical",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "parameters - 13"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let Users = \"{UsersSearch}\";\r\nlet AAD = IdentityInfo\r\n| extend SourceSystem=\"Active Directory\"\r\n| summarize arg_max(TimeGenerated, *) by tostring(AccountObjectId)\r\n| project  TimeGenerated, SourceSystem, AccountDisplayName, UserPrincipalName=AccountUPN, AccountID=AccountObjectId, AD_SID=AccountSID, AD_Groups=GroupMembership, JobTitle, CompanyName, Department, Phone, MailAddress;\r\nlet Combo = SigninLogs\r\n| extend SourceSystem = \"Entra ID\"\r\n| summarize arg_max(TimeGenerated, *) by tostring(UserId)\r\n| project TimeGenerated, SourceSystem, AccountDisplayName=UserDisplayName, UserPrincipalName, AccountID=UserId, UserType, LastDevice = DeviceDetail.displayName, IPAddress\r\n| join kind=fullouter AAD on UserPrincipalName\r\n| extend SourceSystem = iif(isempty( SourceSystem), SourceSystem1, SourceSystem)\r\n| extend UserPrincipalName = iif(isempty( UserPrincipalName), UserPrincipalName1, UserPrincipalName)\r\n| extend AccountDisplayName = iif(isempty( AccountDisplayName), AccountDisplayName1, AccountDisplayName)\r\n| extend AccountID = iif(isempty( AccountID), AccountID1, AccountID)\r\n| extend SourceSystem = iif(isempty( SourceSystem), SourceSystem1, SourceSystem)\r\n| extend TimeGenerated = iif(isempty( TimeGenerated), TimeGenerated1, TimeGenerated)\r\n| project-away SourceSystem1, AccountDisplayName1, AccountID1, SourceSystem1, TimeGenerated1, UserPrincipalName1;\r\nDeviceInfo\r\n| where LoggedOnUsers != \"[]\"\r\n| mvexpand todynamic(LoggedOnUsers)\r\n| extend Sid = LoggedOnUsers.Sid\r\n| extend UserName = LoggedOnUsers.UserName\r\n| summarize arg_max(TimeGenerated, *) by tostring(Sid)\r\n| project DeviceName, AD_SID=Sid\r\n| join kind=rightouter Combo on AD_SID\r\n| extend LastDevice = iif(isempty( LastDevice), DeviceName, LastDevice)\r\n| project SourceSystem, AccountDisplayName, UserPrincipalName, AccountID, UserType, LastDevice, IPAddress, AD_SID=AD_SID1, AD_Groups, JobTitle, CompanyName, Department, Phone, MailAddress\r\n| search Users| project-away $table",
              "size": 1,
              "showAnalytics": true,
              "title": "Select Account(s) Below",
              "timeContext": {
                "durationMs": 2592000000
              },
              "showRefreshButton": true,
              "exportMultipleValues": true,
              "exportedParameters": [
                {
                  "fieldName": "AccountSID",
                  "parameterName": "SID",
                  "parameterType": 1
                },
                {
                  "fieldName": "UserPrincipalName",
                  "parameterName": "Users",
                  "parameterType": 1
                },
                {
                  "fieldName": "AccountDisplayName",
                  "parameterName": "X",
                  "parameterType": 1
                }
              ],
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "gridSettings": {
                "sortBy": [
                  {
                    "itemKey": "AccountDisplayName",
                    "sortOrder": 1
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "AccountDisplayName",
                  "sortOrder": 1
                }
              ]
            },
            "name": "Account Search",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let Users = dynamic([{Users}]);\r\nSecurityIncident\r\n| where TimeGenerated > ago(90d)\r\n| where AlertIds != \"[]\"\r\n| mvexpand todynamic(AlertIds)\r\n| extend SystemAlertId = tostring(AlertIds)\r\n| join SecurityAlert on SystemAlertId\r\n| extend Expand = parse_json(Entities)\r\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\r\n| mvexpand todynamic(Entities)\r\n| extend Type = tostring(Entities.Type)\r\n| where Type == \"account\"\r\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\r\n| extend Name = Entities.UserPrincipalName\r\n| where Name in (Users)\r\n| project TimeGenerated=format_datetime(FirstActivityTime, \"MM/dd/yyyy, hh:mm tt\"), SIEM_ID=IncidentNumber, Incident=Title, Type, ['üß© Common Entity']=Name, Severity, Status, Tactics, ['Incdident URL']=AdditionalData.providerIncidentUrl\r\n| sort by TimeGenerated desc ",
              "size": 1,
              "showAnalytics": true,
              "title": "Related Incidents (90 Days)",
              "timeContext": {
                "durationMs": 2592000000
              },
              "showRefreshButton": true,
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "TimeGenerated",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  },
                  {
                    "columnMatch": "IsEnabled",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "14ch"
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              },
              "sortBy": []
            },
            "conditionalVisibility": {
              "parameterName": "Users",
              "comparison": "isNotEqualTo"
            },
            "name": "Related Incidents (90 Days)",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let Users = dynamic([{Users}]);\r\nIdentityInfo\r\n| where AccountUPN in (Users)\r\n| where isnotempty(AccountUPN)\r\n| summarize arg_max(TimeGenerated, *) by AccountUPN\r\n| extend Location = strcat(City, \", \", State, \", \",Country)\r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), IsEnabled=IsAccountEnabled, AccountDisplayName, AccountUPN, AccountDomain, AccountCreationTime, Location, Department, JobTitle, MailAddress, CompanyName, GroupMembership, AssignedRoles,FQDN=OnPremisesDistinguishedName",
              "size": 1,
              "showAnalytics": true,
              "title": "AD User Profile (MDI)",
              "timeContext": {
                "durationMs": 2592000000
              },
              "showRefreshButton": true,
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "TimeGenerated",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  },
                  {
                    "columnMatch": "IsEnabled",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "14ch"
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              },
              "sortBy": []
            },
            "conditionalVisibility": {
              "parameterName": "Users",
              "comparison": "isNotEqualTo"
            },
            "name": "AD User Profile (MDI)",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let SID = dynamic([{SID}]);\r\nDeviceInfo\r\n| where TimeGenerated > ago(30d)\r\n| where LoggedOnUsers != \"[]\"\r\n| mvexpand todynamic(LoggedOnUsers)\r\n| extend SIDx = tostring(LoggedOnUsers.Sid)\r\n| where SIDx in (SID)\r\n| summarize arg_max(TimeGenerated, *) by DeviceId\r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), DeviceName, ExposureLevel, PublicIP, OSPlatform, ClientVersion, IsAzureADJoined, MachineGroup, DeviceId",
              "size": 1,
              "showAnalytics": true,
              "title": "Recent MDE Workstation Logon (30 Days)",
              "timeContext": {
                "durationMs": 2592000000
              },
              "showRefreshButton": true,
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "TimeGenerated",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  },
                  {
                    "columnMatch": "DeviceName",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "22ch"
                    }
                  },
                  {
                    "columnMatch": "ExposureLevel",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "icons",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "High",
                          "representation": "4",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Medium",
                          "representation": "3",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "Low",
                          "representation": "2",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "representation": "success",
                          "text": "{0}{1}"
                        }
                      ]
                    }
                  },
                  {
                    "columnMatch": "PublicIP",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  },
                  {
                    "columnMatch": "OSPlatform",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "16ch"
                    }
                  },
                  {
                    "columnMatch": "ClientVersion",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  },
                  {
                    "columnMatch": "IsAzureADJoined",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "16ch"
                    }
                  },
                  {
                    "columnMatch": "MachineGroup",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "30ch"
                    }
                  },
                  {
                    "columnMatch": "DeviceId",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "45ch"
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              },
              "sortBy": []
            },
            "conditionalVisibility": {
              "parameterName": "Users",
              "comparison": "isNotEqualTo"
            },
            "name": "Recent MDE Workstation Logon (30 Days)",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let Users = dynamic([{Users}]);\r\nBehaviorAnalytics\r\n| where UserPrincipalName in (Users)\r\n| summarize arg_max(TimeGenerated, *) by UserPrincipalName, tostring(ActivityInsights.App)\r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), Priority=toint(InvestigationPriority), ActivityType, ActionType, UnusualAction = ActivityInsights.ActionUncommonlyPerformedByUser, UnusualDevice = ActivityInsights.DeviceUncommonlyUsedInTenant, FirstConnection = ActivityInsights.FirstTimeUserConnectedFromDevice, HighVolume = ActivityInsights.UncommonHighVolumeOfActions, UserPrincipalName, App = ActivityInsights.App, SourceDevice, SourceIPAddress, SourceIPLocation\r\n| sort by TimeGenerated desc",
              "size": 1,
              "showAnalytics": true,
              "title": "Sentinel UEBA Activity - Sentinel (30 Days)",
              "timeContext": {
                "durationMs": 2592000000
              },
              "showRefreshButton": true,
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "TimeGenerated",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  },
                  {
                    "columnMatch": "Priority",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "max": 5,
                      "palette": "red",
                      "customColumnWidthSetting": "12ch"
                    }
                  },
                  {
                    "columnMatch": "ActivityType",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "30ch"
                    }
                  },
                  {
                    "columnMatch": "ActionType",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "30ch"
                    }
                  },
                  {
                    "columnMatch": "UnusualAction",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "representation": "gray",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "True",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "16ch"
                    }
                  },
                  {
                    "columnMatch": "UnusualDevice",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "True",
                          "representation": "gray",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "16ch"
                    }
                  },
                  {
                    "columnMatch": "FirstConnection",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "True",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "16ch"
                    }
                  },
                  {
                    "columnMatch": "HighVolume",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "True",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "16ch"
                    }
                  },
                  {
                    "columnMatch": "App",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "25ch"
                    }
                  },
                  {
                    "columnMatch": "SourceDevice",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "29ch"
                    }
                  },
                  {
                    "columnMatch": "SourceIPAddress",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "21ch"
                    }
                  },
                  {
                    "columnMatch": "SourceIPLocation",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "31ch"
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              },
              "sortBy": []
            },
            "conditionalVisibility": {
              "parameterName": "Users",
              "comparison": "isNotEqualTo"
            },
            "name": "Sentinel UEBA Activity - Sentinel (30 Days)",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let Users = dynamic([{Users}]);\r\nAnomalies \r\n| where UserPrincipalName in (Users)\r\n| extend  UserCreated = ActivityInsights.UserCreated\r\n| extend  AccountDisplayName = UserInsights.AccountDisplayName\r\n| extend IsNewAccount = UserInsights.IsNewAccount\r\n| extend AnomalyReason = tostring(AnomalyReasons[0].Name)\r\n| project TimeGenerated, AccountDisplayName, UserName, UserPrincipalName, IsNewAccount, UserCreated, AnomalyReason, RuleName, Description\r\n| sort by TimeGenerated desc",
              "size": 1,
              "showAnalytics": true,
              "title": "Sentinel Anomalies Activity - Sentinel (30 Days)",
              "timeContext": {
                "durationMs": 2592000000
              },
              "showRefreshButton": true,
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "TimeGenerated",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  },
                  {
                    "columnMatch": "Priority",
                    "formatter": 8,
                    "formatOptions": {
                      "min": 0,
                      "max": 5,
                      "palette": "red",
                      "customColumnWidthSetting": "12ch"
                    }
                  },
                  {
                    "columnMatch": "ActivityType",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "30ch"
                    }
                  },
                  {
                    "columnMatch": "ActionType",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "30ch"
                    }
                  },
                  {
                    "columnMatch": "UnusualAction",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "representation": "gray",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "==",
                          "thresholdValue": "True",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "16ch"
                    }
                  },
                  {
                    "columnMatch": "UnusualDevice",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "True",
                          "representation": "gray",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "16ch"
                    }
                  },
                  {
                    "columnMatch": "FirstConnection",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "True",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "16ch"
                    }
                  },
                  {
                    "columnMatch": "HighVolume",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "True",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "16ch"
                    }
                  },
                  {
                    "columnMatch": "App",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "25ch"
                    }
                  },
                  {
                    "columnMatch": "SourceDevice",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "29ch"
                    }
                  },
                  {
                    "columnMatch": "SourceIPAddress",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "21ch"
                    }
                  },
                  {
                    "columnMatch": "SourceIPLocation",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "31ch"
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              },
              "sortBy": []
            },
            "conditionalVisibility": {
              "parameterName": "Users",
              "comparison": "isNotEqualTo"
            },
            "name": "Sentinel Anomalies Activity - Sentinel (30 Days)",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let Users = dynamic([{Users}]);\r\nCloudAppEvents\r\n| extend UPN = tostring(RawEventData.UserId)\r\n| where UPN in (Users)\r\n| where ActivityType != \"Sync\" and ActivityType != \"Basic\"\r\n| extend  IsSatelliteProvider = AdditionalFields.IsSatelliteProvider\r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"),  Action=ActionType, Activity=ActivityType, ObjectType, ObjectName,Application, AccountType, User=UPN, UserAgent, IsAnonymousProxy, IsImpersonated, IsExternalUser, IsAdminOperation, IsSatelliteProvider, OSPlatform, ISP, IPAddress, IPCategory\r\n| sort by TimeGenerated desc",
              "size": 1,
              "showAnalytics": true,
              "title": "Cloud Apps Activity - MDCA (30 Days)",
              "timeContext": {
                "durationMs": 2592000000
              },
              "showRefreshButton": true,
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "TimeGenerated",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  },
                  {
                    "columnMatch": "Action",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "25ch"
                    }
                  },
                  {
                    "columnMatch": "Activity",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "25ch"
                    }
                  },
                  {
                    "columnMatch": "ObjectType",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  },
                  {
                    "columnMatch": "ObjectName",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "30ch"
                    }
                  },
                  {
                    "columnMatch": "AccountType",
                    "formatter": 18,
                    "formatOptions": {
                      "thresholdsOptions": "colors",
                      "thresholdsGrid": [
                        {
                          "operator": "==",
                          "thresholdValue": "Admin",
                          "representation": "red",
                          "text": "{0}{1}"
                        },
                        {
                          "operator": "Default",
                          "thresholdValue": null,
                          "text": "{0}{1}"
                        }
                      ],
                      "customColumnWidthSetting": "17ch"
                    }
                  },
                  {
                    "columnMatch": "IsSatelliteProvider",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "22ch"
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              },
              "sortBy": []
            },
            "conditionalVisibility": {
              "parameterName": "Users",
              "comparison": "isNotEqualTo"
            },
            "name": "Cloud Apps Activity - MDCA (30 Days)",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let Users = dynamic([{Users}]);\r\nOfficeActivity\r\n| where UserId in (Users)\r\n| where Operation !contains \"Sync\"\r\n|project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), UserId, UserType, Logon_Type, ExternalAccess, OfficeWorkload, Operation, ItemType, Subject=parse_json(AffectedItems)[0].Subject, Site_Url, RecordType, SourceFileName, ResultStatus, ClientIP, IsManagedDevice\r\n| sort by TimeGenerated desc",
              "size": 1,
              "showAnalytics": true,
              "title": "Office Activity - MDO (30 Days)",
              "timeContext": {
                "durationMs": 2592000000
              },
              "showRefreshButton": true,
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "TimeGenerated",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              },
              "sortBy": []
            },
            "conditionalVisibility": {
              "parameterName": "Users",
              "comparison": "isNotEqualTo"
            },
            "name": "Office Activity - MDO (30 Days)",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let Users = dynamic([{Users}]);\r\nEmailEvents\r\n| where RecipientEmailAddress in (Users) or SenderDisplayName in (Users)\r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), RecipientEmailAddress, SenderDisplayName, SenderFromAddress, SenderIPv4, Subject, AttachmentCount, UrlCount\r\n| sort by TimeGenerated desc",
              "size": 1,
              "showAnalytics": true,
              "title": "Emails Sent & Received - MDO (30 Days)",
              "timeContext": {
                "durationMs": 2592000000
              },
              "showRefreshButton": true,
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "TimeGenerated",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              },
              "sortBy": []
            },
            "conditionalVisibility": {
              "parameterName": "Users",
              "comparison": "isNotEqualTo"
            },
            "name": "Emails Sent & Received - MDO (30 Days)",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let Users = dynamic([{Users}]);\r\nEmailAttachmentInfo\r\n| where RecipientEmailAddress in (Users) or SenderDisplayName in (Users)\r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), RecipientEmailAddress, SenderDisplayName, SenderFromAddress, FileName, FileSize\r\n| sort by TimeGenerated desc",
              "size": 1,
              "showAnalytics": true,
              "title": "Attachments Sent & Received - MDO (30 Days)",
              "timeContext": {
                "durationMs": 2592000000
              },
              "showRefreshButton": true,
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "TimeGenerated",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              },
              "sortBy": []
            },
            "conditionalVisibility": {
              "parameterName": "Users",
              "comparison": "isNotEqualTo"
            },
            "name": "Attachments Sent & Received - MDO (30 Days)",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let Users = dynamic([{Users}]);\r\nUrlClickEvents\r\n| where AccountUpn in (Users)\r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), AccountUpn, Workload, ActionType, Url, IPAddress, UrlChain, IsClickedThrough\r\n| sort by TimeGenerated desc",
              "size": 1,
              "showAnalytics": true,
              "title": "URLs Clicked - MDO (30 Days)",
              "timeContext": {
                "durationMs": 2592000000
              },
              "showRefreshButton": true,
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "TimeGenerated",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              },
              "sortBy": []
            },
            "conditionalVisibility": {
              "parameterName": "Users",
              "comparison": "isNotEqualTo"
            },
            "name": "URLs Clicked - MDO (30 Days)",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let Users = dynamic([{Users}]);\r\nunion isfuzzy=true (IdentityDirectoryEvents), (IdentityLogonEvents),(IdentityQueryEvents)\r\n| where AccountUpn in (Users)\r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), ActionType, LogonType, FailureReason, Application, Protocol, AccountUpn, DeviceName, IPAddress, Type, QueryTarget",
              "size": 1,
              "showAnalytics": true,
              "title": "MDI Activity - Local Domain (30 Days)",
              "timeContext": {
                "durationMs": 2592000000
              },
              "showRefreshButton": true,
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "TimeGenerated",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  },
                  {
                    "columnMatch": "Application",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "24ch"
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              },
              "sortBy": []
            },
            "conditionalVisibility": {
              "parameterName": "Users",
              "comparison": "isNotEqualTo"
            },
            "name": "MDI Activity - Local Domain  (30 Days)",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let Users = dynamic([{Users}]);\r\nSigninLogs\r\n| where UserPrincipalName in (Users)\r\n| extend authenticationMethod = parse_json(AuthenticationDetails)[0].authenticationMethod\r\n| extend Browser = DeviceDetail.browser\r\n| extend DeviceId = DeviceDetail.deviceId\r\n| extend OS = DeviceDetail.operatingSystem\r\n| extend City = LocationDetails.city\r\n| extend State = LocationDetails.state\r\n| extend Country = LocationDetails.countryOrRegion\r\n| extend Latitude = parse_json(tostring(LocationDetails.geoCoordinates)).latitude\r\n| extend Longitude = parse_json(tostring(LocationDetails.geoCoordinates)).longitude\r\n| extend Network = parse_json(NetworkLocationDetails)[0].networkType\r\n| extend NamedNet = parse_json(tostring(parse_json(NetworkLocationDetails)[0].networkNames))[0]\r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), UserDisplayName, UserPrincipalName, UserType, RiskDetail, RiskState, AuthenticationRequirement, ConditionalAccessStatus, MfaDetail, ResultDescription, AppDisplayName, ResourceDisplayName, ClientAppUsed, Browser, DeviceId, OS, IPAddress, Network, NamedNet, City, State, Country, Latitude, Longitude\r\n| sort by TimeGenerated desc",
              "size": 1,
              "showAnalytics": true,
              "title": "Entra SignIn Activity (30 Days)",
              "timeContext": {
                "durationMs": 2592000000
              },
              "showRefreshButton": true,
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "TimeGenerated",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  },
                  {
                    "columnMatch": "UserDisplayName",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "19.1429ch"
                    }
                  },
                  {
                    "columnMatch": "UserPrincipalName",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "22.1429ch"
                    }
                  },
                  {
                    "columnMatch": "UserType",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "10.4275ch"
                    }
                  },
                  {
                    "columnMatch": "RiskDetail",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "9.428ch"
                    }
                  },
                  {
                    "columnMatch": "RiskState",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "9.2854ch"
                    }
                  },
                  {
                    "columnMatch": "AuthenticationRequirement",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "17.1423ch"
                    }
                  },
                  {
                    "columnMatch": "ConditionalAccessStatus",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "9.7131ch"
                    }
                  },
                  {
                    "columnMatch": "MfaDetail",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "11.4286ch"
                    }
                  },
                  {
                    "columnMatch": "ResultDescription",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "19.4286ch"
                    }
                  },
                  {
                    "columnMatch": "AppDisplayName",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "26.8571ch"
                    }
                  },
                  {
                    "columnMatch": "ResourceDisplayName",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "27ch"
                    }
                  },
                  {
                    "columnMatch": "ClientAppUsed",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "19.1423ch"
                    }
                  },
                  {
                    "columnMatch": "Browser",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "19.4286ch"
                    }
                  },
                  {
                    "columnMatch": "DeviceId",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "22.2851ch"
                    }
                  },
                  {
                    "columnMatch": "OS",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "16.142ch"
                    }
                  },
                  {
                    "columnMatch": "IPAddress",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "15.1429ch"
                    }
                  },
                  {
                    "columnMatch": "Network",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "16.9997ch"
                    }
                  },
                  {
                    "columnMatch": "NamedNet",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "16ch"
                    }
                  },
                  {
                    "columnMatch": "City",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "14.1423ch"
                    }
                  },
                  {
                    "columnMatch": "State",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "9.2854ch"
                    }
                  },
                  {
                    "columnMatch": "Country",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "9.4278ch"
                    }
                  },
                  {
                    "columnMatch": "Latitude",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "8.1426ch"
                    }
                  },
                  {
                    "columnMatch": "Longitude",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "8.7137ch"
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true,
                "sortBy": [
                  {
                    "itemKey": "TimeGenerated",
                    "sortOrder": 2
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "TimeGenerated",
                  "sortOrder": 2
                }
              ]
            },
            "conditionalVisibility": {
              "parameterName": "Users",
              "comparison": "isNotEqualTo"
            },
            "name": "Entra SignIn Activity (30 Days)",
            "styleSettings": {
              "showBorder": true
            }
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let Users = dynamic([{Users}]);\r\nSigninLogs\r\n| where UserPrincipalName in (Users)\r\n| extend City = LocationDetails.city\r\n| extend State = LocationDetails.state\r\n| extend Country = LocationDetails.countryOrRegion\r\n| extend Latitude = parse_json(tostring(LocationDetails.geoCoordinates)).latitude\r\n| extend Longitude = parse_json(tostring(LocationDetails.geoCoordinates)).longitude\r\n| project TimeGenerated, City, State, Country, Latitude, Longitude\r\n| summarize count() by tostring(Latitude), tostring(Longitude), tostring(City)",
              "size": 2,
              "title": "SignIn Locations (Entra)",
              "timeContext": {
                "durationMs": 2592000000
              },
              "showRefreshButton": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "visualization": "map",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "TimeGenerated",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "15.2846ch"
                    }
                  },
                  {
                    "columnMatch": "UserDisplayName",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "19.1429ch"
                    }
                  },
                  {
                    "columnMatch": "UserPrincipalName",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "22.1429ch"
                    }
                  },
                  {
                    "columnMatch": "UserType",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "10.4275ch"
                    }
                  },
                  {
                    "columnMatch": "RiskDetail",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "9.428ch"
                    }
                  },
                  {
                    "columnMatch": "RiskState",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "9.2854ch"
                    }
                  },
                  {
                    "columnMatch": "AuthenticationRequirement",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "17.1423ch"
                    }
                  },
                  {
                    "columnMatch": "ConditionalAccessStatus",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "9.7131ch"
                    }
                  },
                  {
                    "columnMatch": "MfaDetail",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "11.4286ch"
                    }
                  },
                  {
                    "columnMatch": "ResultDescription",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "19.4286ch"
                    }
                  },
                  {
                    "columnMatch": "AppDisplayName",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "26.8571ch"
                    }
                  },
                  {
                    "columnMatch": "ResourceDisplayName",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "27ch"
                    }
                  },
                  {
                    "columnMatch": "ClientAppUsed",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "19.1423ch"
                    }
                  },
                  {
                    "columnMatch": "Browser",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "19.4286ch"
                    }
                  },
                  {
                    "columnMatch": "DeviceId",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "22.2851ch"
                    }
                  },
                  {
                    "columnMatch": "OS",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "16.142ch"
                    }
                  },
                  {
                    "columnMatch": "IPAddress",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "15.1429ch"
                    }
                  },
                  {
                    "columnMatch": "Network",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "16.9997ch"
                    }
                  },
                  {
                    "columnMatch": "NamedNet",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "16ch"
                    }
                  },
                  {
                    "columnMatch": "City",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "14.1423ch"
                    }
                  },
                  {
                    "columnMatch": "State",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "9.2854ch"
                    }
                  },
                  {
                    "columnMatch": "Country",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "9.4278ch"
                    }
                  },
                  {
                    "columnMatch": "Latitude",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "8.1426ch"
                    }
                  },
                  {
                    "columnMatch": "Longitude",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "8.7137ch"
                    }
                  }
                ],
                "rowLimit": 10000,
                "sortBy": [
                  {
                    "itemKey": "Longitude",
                    "sortOrder": 1
                  }
                ]
              },
              "sortBy": [
                {
                  "itemKey": "Longitude",
                  "sortOrder": 1
                }
              ],
              "mapSettings": {
                "locInfo": "LatLong",
                "latitude": "Latitude",
                "longitude": "Longitude",
                "sizeSettings": "City",
                "sizeAggregation": "Count",
                "labelSettings": "City",
                "legendMetric": "count_",
                "numberOfMetrics": 1000,
                "legendAggregation": "Sum",
                "itemColorSettings": {
                  "nodeColorField": "count_",
                  "colorAggregation": "Sum",
                  "type": "heatmap",
                  "heatmapPalette": "greenRed"
                }
              }
            },
            "conditionalVisibility": {
              "parameterName": "Users",
              "comparison": "isNotEqualTo"
            },
            "name": "SignIn Locations (Entra)"
          },
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "let Users = dynamic([{Users}]);\r\nAzureActivity\r\n| where isnotempty(Caller)\r\n| extend Caller2 = tolower(Caller) \r\n| where Caller in (Users) or Caller2 in (Users)\r\n| extend Status = parse_json(Properties).activityStatusValue\r\n| extend RBAC_Role = parse_json(tostring(parse_json(Authorization).evidence)).role\r\n| extend Target = parse_json(Properties).resource\r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), Caller, Level, Target, ResourceGroup, SubscriptionId, OperationNameValue, Status, RBAC_Role, CallerIpAddress, ResourceId, CategoryValue\r\n| sort by TimeGenerated desc",
              "size": 1,
              "showAnalytics": true,
              "title": "Azure Admin Activity (30 Days)",
              "noDataMessage": "The query returned no results. No Azure admin activity detected for selected accounts. ",
              "timeContext": {
                "durationMs": 2592000000
              },
              "showRefreshButton": true,
              "showExportToExcel": true,
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "gridSettings": {
                "formatters": [
                  {
                    "columnMatch": "TimeGenerated",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "16.9989ch"
                    }
                  },
                  {
                    "columnMatch": "Level",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "13.2846ch"
                    }
                  },
                  {
                    "columnMatch": "Target",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "29.142ch"
                    }
                  },
                  {
                    "columnMatch": "ResourceGroup",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "24.2857ch"
                    }
                  },
                  {
                    "columnMatch": "SubscriptionId",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "15.9994ch"
                    }
                  },
                  {
                    "columnMatch": "OperationNameValue",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "31.2857ch"
                    }
                  },
                  {
                    "columnMatch": "Status",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "17ch"
                    }
                  },
                  {
                    "columnMatch": "Caller",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "12ch"
                    }
                  },
                  {
                    "columnMatch": "RBAC_Role",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "15ch"
                    }
                  },
                  {
                    "columnMatch": "CallerIpAddress",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "21ch"
                    }
                  },
                  {
                    "columnMatch": "ResourceId",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "16ch"
                    }
                  },
                  {
                    "columnMatch": "CategoryValue",
                    "formatter": 0,
                    "formatOptions": {
                      "customColumnWidthSetting": "20ch"
                    }
                  }
                ],
                "rowLimit": 10000,
                "filter": true
              },
              "sortBy": []
            },
            "conditionalVisibility": {
              "parameterName": "Users",
              "comparison": "isNotEqualTo"
            },
            "name": "Azure Admin Activity (30 Days)",
            "styleSettings": {
              "showBorder": true
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "Accounts"
      },
      "name": "Accounts Explorer"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "title": "IPs Explorer",
        "items": [
          {
            "type": 1,
            "content": {
              "json": "Add one or more complete IP address to search related logs.",
              "style": "success"
            },
            "name": "text - 0 - Copy"
          },
          {
            "type": 9,
            "content": {
              "version": "KqlParameterItem/1.0",
              "parameters": [
                {
                  "id": "a4eaa160-1cce-4802-82f8-973b096a9ba4",
                  "version": "KqlParameterItem/1.0",
                  "name": "Address",
                  "type": 9,
                  "multiSelect": true,
                  "quote": "'",
                  "delimiter": ",",
                  "timeContext": {
                    "durationMs": 86400000
                  }
                }
              ],
              "style": "formVertical",
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces"
            },
            "name": "IP_Search"
          },
          {
            "type": 12,
            "content": {
              "version": "NotebookGroup/1.0",
              "groupType": "editable",
              "title": "IP Address Queries",
              "items": [
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let Address = dynamic([{Address}]);\r\nSecurityIncident\r\n| where TimeGenerated > ago(90d)\r\n| where AlertIds != \"[]\"\r\n| mvexpand todynamic(AlertIds)\r\n| extend SystemAlertId = tostring(AlertIds)\r\n| join SecurityAlert on SystemAlertId\r\n| extend Expand = parse_json(Entities)\r\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\r\n| mvexpand todynamic(Entities)\r\n| extend Type = Entities.Type\r\n| where isnotempty(Type)\r\n| extend Name = Entities.Name\r\n| extend Name = iff(Type == \"host\", Entities.HostName, Name)\r\n| extend Name = iff(Type == \"process\", Entities.CommandLine, Name)\r\n| extend Name = iff(Type == \"ip\", Entities.Address, Name)\r\n| extend Name = iff(Type == \"mailbox\", Entities.MailboxPrimaryAddress, Name)\r\n| extend Name = iff(Type == \"url\", Entities.Url, Name)\r\n| extend Name = iff(Type == \"filehash\", Entities.Value, Name)\r\n| extend Name = iff(Type == \"dns\", Entities.DomainName, Name)\r\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\r\n| where Type == \"ip\" and Name in (Address)\r\n| project TimeGenerated=format_datetime(FirstActivityTime, \"MM/dd/yyyy, hh:mm tt\"), SIEM_ID=IncidentNumber, Incident=Title, Type, ['üß© Common Entity']=Name, Severity, Status, Tactics, ['Incdident URL']=AdditionalData.providerIncidentUrl\r\n| sort by TimeGenerated desc ",
                    "size": 1,
                    "showAnalytics": true,
                    "title": "Related Incidents (90 Days)",
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "rowLimit": 10000
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "Address",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "Related Incidents (90 Days)"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let Address = dynamic([{Address}]);\r\nSigninLogs\r\n| where IPAddress in (Address)\r\n| extend authenticationMethod = parse_json(AuthenticationDetails)[0].authenticationMethod\r\n| extend Browser = DeviceDetail.browser\r\n| extend DeviceId = DeviceDetail.deviceId\r\n| extend OS = DeviceDetail.operatingSystem\r\n| extend City = LocationDetails.city\r\n| extend State = LocationDetails.state\r\n| extend Country = LocationDetails.countryOrRegion\r\n| extend Latitude = parse_json(tostring(LocationDetails.geoCoordinates)).latitude\r\n| extend Longitude = parse_json(tostring(LocationDetails.geoCoordinates)).longitude\r\n| extend Network = parse_json(NetworkLocationDetails)[0].networkType\r\n| extend NamedNet = parse_json(tostring(parse_json(NetworkLocationDetails)[0].networkNames))[0]\r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), UserDisplayName, UserPrincipalName, UserType, RiskDetail, RiskState, AuthenticationRequirement, ConditionalAccessStatus, MfaDetail, ResultDescription, AppDisplayName, ResourceDisplayName, ClientAppUsed, Browser, DeviceId, OS, IPAddress, Network, NamedNet, City, State, Country, Latitude, Longitude\r\n| sort by TimeGenerated desc",
                    "size": 1,
                    "showAnalytics": true,
                    "title": "Entra SignIn Logs",
                    "timeContext": {
                      "durationMs": 604800000
                    },
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "rowLimit": 10000
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "Address",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "Entra SignIn Logs"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let Address = dynamic([{Address}]);\r\nAADNonInteractiveUserSignInLogs\r\n| where IPAddress in (Address)\r\n| extend City = parse_json(LocationDetails).city\r\n| extend State = parse_json(LocationDetails).state\r\n| extend NetworkType = parse_json(NetworkLocationDetails)[0].networkType\r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), IPAddress, NetworkType, AppDisplayName, OperationName, Identity, UserType, Country=Location, City, State, ClientAppUsed, ConditionalAccessStatus, IsInteractive, RiskDetail\r\n| sort by TimeGenerated desc",
                    "size": 1,
                    "showAnalytics": true,
                    "title": "Entra Non-Interactive SignIn Logs",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "rowLimit": 10000
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "Address",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "Entra Non-Interactive SignIn Logs"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let Address = dynamic([{Address}]);\r\nAADUserRiskEvents\r\n| where IpAddress in (Address)\r\n| extend City = Location.city\r\n| extend Country = Location.countryOrRegion\r\n| extend State = Location.state\r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), IpAddress, Activity,   RiskLevel, RiskDetail, RiskEventType, UserDisplayName, Country, City, State\r\n| sort by TimeGenerated desc",
                    "size": 1,
                    "showAnalytics": true,
                    "title": "Entra Risky Events",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "rowLimit": 10000
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "Address",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "Entra Risky Events"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let Address = dynamic([{Address}]);\r\nAuditLogs\r\n| extend IpAddress = parse_json(tostring(InitiatedBy.user)).ipAddress\r\n| where isnotempty( IpAddress)\r\n| where IpAddress in (Address)\r\n| extend TargetResources = TargetResources[0].displayName\r\n| extend InitiatedBy = parse_json(tostring(InitiatedBy.user)).userPrincipalName\r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), IpAddress, InitiatedBy, TargetResources, OperationName, Category, Resource, Identity, ActivityDisplayName, Result, ResultReason\r\n| sort by TimeGenerated desc",
                    "size": 1,
                    "showAnalytics": true,
                    "title": "Entra Admin Audit Logs",
                    "timeContext": {
                      "durationMs": 604800000
                    },
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "rowLimit": 10000
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "Address",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "Entra Audit Logs"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let Address = dynamic([{Address}]);\r\nDeviceInfo\r\n| where PublicIP in (Address)\r\n| summarize arg_max(TimeGenerated, *) by PublicIP, DeviceId\r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), DeviceName, ExposureLevel, PublicIP, OSPlatform, ClientVersion, IsAzureADJoined, JoinType, LoggedOnUsers, MachineGroup, DeviceId, DeviceManualTags, DeviceDynamicTags, RegistryDeviceTag\r\n| sort by TimeGenerated desc",
                    "size": 1,
                    "title": "Known Device Public IP",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "rowLimit": 10000
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "Address",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "DeviceIP"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let Address = dynamic([{Address}]);\r\nDeviceNetworkEvents\r\n| where LocalIP in (Address) or RemoteIP in (Address)\r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), LocalIP, LocalPort, RemoteIP, RemotePort, ActionType, InitiatingProductName=InitiatingProcessVersionInfoProductName, RemoteUrl, DeviceName, DeviceId, InitiatingProcessCommandLine, InitiatingProcessFolderPath\r\n| sort by TimeGenerated desc",
                    "size": 1,
                    "showAnalytics": true,
                    "title": "Device Network Events",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "rowLimit": 10000
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "Address",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "Device Network Events"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let Address = dynamic([{Address}]);\r\nDeviceLogonEvents\r\n| where RemoteIP in (Address)\r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), RemoteIP, LogonType, ActionType, Protocol, RemotePort, AccountName, DeviceName, DeviceId\r\n| sort by TimeGenerated desc",
                    "size": 1,
                    "showAnalytics": true,
                    "title": "Related Device Logon Events",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "rowLimit": 10000
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "Address",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "DeviceLogonEvents"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let Address = dynamic([{Address}]);\r\nDeviceNetworkInfo\r\n| extend AddressType =IPAddresses[0].AddressType\r\n| extend IPAddress = IPAddresses[0].IPAddress\r\n| where IPAddress in (Address)\r\n| summarize arg_max(TimeGenerated, *) by tostring(IPAddresses), DeviceId\r\n| extend DefaultGateway = DefaultGateways[0]\r\n| extend IsConnectedToInternet = ConnectedNetworks[0].IsConnectedToInternet\r\n| extend NetworkCategory = ConnectedNetworks[0].Category\r\n| extend NetworkName = ConnectedNetworks[0].Name\r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"),IPAddress, DeviceName, DeviceId, DefaultGateway, DnsAddresses, MacAddress, IPv4Dhcp, NetworkAdapterStatus, IsConnectedToInternet, NetworkCategory, NetworkName, NetworkAdapterVendor\r\n| sort by TimeGenerated desc",
                    "size": 1,
                    "title": "Device IP Config Details",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "rowLimit": 10000
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "Address",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "DeviceNetworkInfo"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let Address = dynamic([{Address}]);\r\nWVDConnections\r\n| where SessionHostIPAddress in (Address)\r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), SessionHostIPAddress, SessionHostName, ClientOS,  UserName, State, SessionHostPoolType, ConnectionType\r\n| sort by TimeGenerated desc",
                    "size": 1,
                    "showAnalytics": true,
                    "title": "Related Virtual Desktops",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "rowLimit": 10000
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "Address",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "VirtualDesktops IPs"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let Address = dynamic([{Address}]);\r\nBehaviorAnalytics\r\n| where SourceIPAddress in (Address)\r\n| extend Resource = ActivityInsights.Resource\r\n| extend App = ActivityInsights.App\r\n| extend RareUserAction = iif(isempty(ActivityInsights.ActionUncommonlyPerformedByUser), \"False\", ActivityInsights.ActionUncommonlyPerformedByUser)\r\n| extend RareUserApp = iif(isempty(ActivityInsights.AppUncommonlyUsedByUser), \"False\", ActivityInsights.AppUncommonlyUsedByUser)\r\n| extend RareUserLocation = iif(isempty(ActivityInsights.CountryUncommonlyConnectedFromByUser), \"False\", ActivityInsights.CountryUncommonlyConnectedFromByUser)\r\n| extend RareTenantLocation = iif(isempty(ActivityInsights.CountryUncommonlyConnectedFromInTenant), \"False\", ActivityInsights.CountryUncommonlyConnectedFromInTenant)\r\n| extend RareUserResource = iif(isempty(ActivityInsights.ResourceUncommonlyAccessedByUser), \"False\", ActivityInsights.ResourceUncommonlyAccessedByUser)\r\n| extend RareTenantResource = iif(isempty(ActivityInsights.ResourceUncommonlyAccessedInTenant), \"False\", ActivityInsights.ResourceUncommonlyAccessedInTenant)\r\n| extend HighVolumeAction = iif(isempty(ActivityInsights.UncommonHighVolumeOfActions), \"False\", ActivityInsights.UncommonHighVolumeOfActions)\r\n| extend HighFailureSource = iif(isempty(ActivityInsights.UnusualNumberOfDistinctUsersFailedSignInFromIPAddress), \"False\", ActivityInsights.UnusualNumberOfDistinctUsersFailedSignInFromIPAddress)\r\n| extend HighFailureUser = iif(isempty(ActivityInsights.UnusualNumberOfFailedSignInOfThisUser), \"False\", ActivityInsights.UnusualNumberOfFailedSignInOfThisUser)\r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), SourceIPAddress, ActivityType, ActionType, UserName, UserPrincipalName, EventSource, InvestigationPriority, Resource, App, RareUserAction, RareUserApp, RareUserLocation, RareTenantLocation, RareUserResource, RareTenantResource, HighVolumeAction, HighFailureSource, HighFailureUser\r\n| sort by TimeGenerated desc",
                    "size": 1,
                    "showAnalytics": true,
                    "title": "Sentinel UEBA Logs",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "rowLimit": 10000
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "Address",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "Sentinel UEBA Logs"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let Address = dynamic([{Address}]);\r\nAzureDiagnostics\r\n| extend sourceIPs = parse_json(log_s).sourceIPs\r\n| where isnotempty(sourceIPs)\r\n| extend SourceIP = tostring(sourceIPs[0])\r\n| where SourceIP in (Address)\r\n| extend RequestURI = parse_json(log_s).requestURI\r\n| extend Verb = parse_json(log_s).verb\r\n| extend Username = parse_json(tostring(parse_json(log_s).user)).username\r\n| extend Code = parse_json(tostring(parse_json(log_s).responseStatus)).code\r\n| project TimeGenerated=format_datetime(TimeGenerated, \"MM/dd/yyyy, hh:mm tt\"), SourceIP, Category, Resource, ResourceGroup, ResourceType, OperationName, RequestURI, Verb, Code, Username\r\n| sort by TimeGenerated desc",
                    "size": 1,
                    "showAnalytics": true,
                    "title": "Azure Diagnostic Logs",
                    "timeContext": {
                      "durationMs": 604800000
                    },
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "gridSettings": {
                      "rowLimit": 10000
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "Address",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "Azure Diagnostic Logs"
                },
                {
                  "type": 3,
                  "content": {
                    "version": "KqlItem/1.0",
                    "query": "let Address = dynamic([{Address}]);\r\nlet SigninLogs =SigninLogs\r\n| extend City = tostring(LocationDetails.city)\r\n| extend State = tostring(LocationDetails.state)\r\n| extend Country = tostring(LocationDetails.countryOrRegion)\r\n| extend Latitude = tostring(parse_json(tostring(LocationDetails.geoCoordinates)).latitude)\r\n| extend Longitude = tostring(parse_json(tostring(LocationDetails.geoCoordinates)).longitude)\r\n| project TimeGenerated, IPAddress, City, State, Country, Latitude, Longitude\r\n| project-away TimeGenerated;\r\nSecurityIncident\r\n| summarize arg_max(TimeGenerated, *) by IncidentNumber\r\n| mvexpand todynamic(AlertIds)\r\n| extend SystemAlertId = tostring(AlertIds)\r\n| join SecurityAlert on SystemAlertId\r\n| project Expand = parse_json(Entities)\r\n| mvexpand Expand\r\n| extend Type = tostring(Expand.Type)\r\n| where Type == \"ip\"\r\n| extend Name = tostring(Expand.Name)\r\n| extend IPAddress = tostring(Expand.Address)\r\n| extend Location = tostring(Expand.Location)\r\n| extend City = tostring(Expand.Location.City)\r\n| extend State = tostring(Expand.Location.State)\r\n| extend CountryCode = tostring(Expand.Location.CountryCode)\r\n| extend Latitude = tostring(Expand.Location.Latitude)\r\n| extend Longitude = tostring(Expand.Location.Longitude)\r\n| where isnotempty(Latitude)\r\n| project IPAddress, City, State, Country=CountryCode, Latitude, Longitude\r\n| union SigninLogs\r\n| summarize arg_max(City, * ) by IPAddress\r\n| where IPAddress in (Address)",
                    "size": 2,
                    "showAnalytics": true,
                    "title": "Location Map",
                    "noDataMessage": "Unable to find IP location.",
                    "timeContext": {
                      "durationMs": 2592000000
                    },
                    "showRefreshButton": true,
                    "showExportToExcel": true,
                    "queryType": 0,
                    "resourceType": "microsoft.operationalinsights/workspaces",
                    "visualization": "map",
                    "gridSettings": {
                      "rowLimit": 10000
                    },
                    "mapSettings": {
                      "locInfo": "LatLong",
                      "latitude": "Latitude",
                      "longitude": "Longitude",
                      "sizeAggregation": "Sum",
                      "defaultSize": 15,
                      "labelSettings": "City",
                      "legendMetric": "IPAddress",
                      "legendAggregation": "Count",
                      "itemColorSettings": null
                    }
                  },
                  "conditionalVisibility": {
                    "parameterName": "Address",
                    "comparison": "isNotEqualTo"
                  },
                  "name": "Location Map"
                }
              ]
            },
            "name": "IP Address Queries"
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "IPs"
      },
      "name": "IPs Explorer"
    }
  ],
  "fallbackResourceIds": [
    "/subscriptions/<subscription-id>/resourceGroups/<resource-group>/providers/Microsoft.OperationalInsights/workspaces/<workspace-name>"
  ],
  "styleSettings": {
    "paddingStyle": "wide",
    "spacingStyle": "none"
  },
  "fromTemplateId": "sentinel-UserWorkbook",
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}